

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!--
##
##  This file is part of the pyFormex project.
##  pyFormex is a tool for generating, manipulating and transforming 3D
##  geometrical models by sequences of mathematical operations.
##  Home page: http://pyformex.org
##  Project page:  http://savannah.nongnu.org/projects/pyformex/
##  Copyright (C) Benedict Verhegghe (benedict.verhegghe@ugent.be)
##  Distributed under the GNU General Public License version 3 or later.
##
##
##  This program is free software: you can redistribute it and/or modify
##  it under the terms of the GNU General Public License as published by
##  the Free Software Foundation, either version 3 of the License, or
##  (at your option) any later version.
##
##  This program is distributed in the hope that it will be useful,
##  but WITHOUT ANY WARRANTY; without even the implied warranty of
##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
##  GNU General Public License for more details.
##
##  You should have received a copy of the GNU General Public License
##  along with this program.  If not, see http://www.gnu.org/licenses/.
##
-->
    <title>field &#8212; pyFormex 3.3 documentation</title>

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pyformex.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link rel="icon" type="image/png" href="../_static/pyformex_fav.png" />

  </head><body>

<div class="header">
  <a href="http://pyformex.org">
  <img src="../_static/scallop_dome_small.png" alt="scallop dome" border="0" hspace="20" vspace="12" align="left" />
  <img src="../_static/pyformex-logo-2.png" alt="pyformex logo" border="0" hspace="10" vspace="8" align="left" />
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 3.3 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &gt;</li>
        <!--li class="nav-item nav-item-this"><a href="">field</a></li--> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<!-- PYFORMEX_SIDEBAR_LOGO -->
<!-- PYFORMEX_WEBSITE_SIDEBAR_TOP -->

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for field</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1">##</span>
<span class="c1">##  SPDX-FileCopyrightText: Â© 2007-2023 Benedict Verhegghe &lt;bverheg@gmail.com&gt;</span>
<span class="c1">##  SPDX-License-Identifier: GPL-3.0-or-later</span>
<span class="c1">##</span>
<span class="c1">##  This file is part of pyFormex 3.3  (Sun Mar 26 20:16:15 CEST 2023)</span>
<span class="c1">##  pyFormex is a tool for generating, manipulating and transforming 3D</span>
<span class="c1">##  geometrical models by sequences of mathematical operations.</span>
<span class="c1">##  Home page: https://pyformex.org</span>
<span class="c1">##  Project page: https://savannah.nongnu.org/projects/pyformex/</span>
<span class="c1">##  Development: https://gitlab.com/bverheg/pyformex</span>
<span class="c1">##  Distributed under the GNU General Public License version 3 or later.</span>
<span class="c1">##</span>
<span class="c1">##  This program is free software: you can redistribute it and/or modify</span>
<span class="c1">##  it under the terms of the GNU General Public License as published by</span>
<span class="c1">##  the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">##  (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1">##  This program is distributed in the hope that it will be useful,</span>
<span class="c1">##  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">##  GNU General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1">##  You should have received a copy of the GNU General Public License</span>
<span class="c1">##  along with this program.  If not, see http://www.gnu.org/licenses/.</span>
<span class="c1">##</span>
<span class="c1">#</span>
<span class="c1">##  This program is distributed in the hope that it will be useful,</span>
<span class="c1">##  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">##  GNU General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1">##  You should have received a copy of the GNU General Public License</span>
<span class="c1">##  along with this program.  If not, see http://www.gnu.org/licenses/.</span>
<span class="c1">##</span>

<span class="sd">&quot;&quot;&quot;Field data defined over a geometry.</span>

<span class="sd">This module defines the Field class, which can be used to describe</span>
<span class="sd">scalar and vectorial field data over a geometrical domain.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pyformex</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">import</span> <span class="nn">pyformex.arraytools</span> <span class="k">as</span> <span class="nn">at</span>

<span class="c1">##############################################################</span>


<div class="viewcode-block" id="Field"><a class="viewcode-back" href="../ref/field.html#field.Field">[docs]</a><span class="k">class</span> <span class="nc">Field</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot;Scalar or vectorial field data defined over a geometric domain.</span>

<span class="sd">    A scalar data field is a quantity having exactly one value in each</span>
<span class="sd">    point of some geometric domain. A vectorial field is a quantity having</span>
<span class="sd">    exactly `nval` values at each point, where `nval &gt;= 1`.</span>
<span class="sd">    A vectorial field can also be considered as a collection of `nval`</span>
<span class="sd">    scalar fields: as far as the Field class is concerned, there is no</span>
<span class="sd">    relation between the `nval` components of a vectorial field.</span>

<span class="sd">    The definition of a field is always tied to some geometric domain.</span>
<span class="sd">    Currently pyFormex allows fields to be defined on Formex and Mesh</span>
<span class="sd">    type geometries.</span>

<span class="sd">    Fields should only be defined on geometries whose topology does not</span>
<span class="sd">    change anymore. This means that for Formex type, the shape of the</span>
<span class="sd">    `coords` attribute should not be changed, and for Mesh type, the</span>
<span class="sd">    shape of `coords` and the full contents of `elems` should not be</span>
<span class="sd">    changed. It is therefore best ot only add field data to geometry</span>
<span class="sd">    objects that will not be changed in place.</span>
<span class="sd">    Nearly all methods in pyFormex return a copy of the object, and the</span>
<span class="sd">    copy currently looses all the fields defined on the parent.</span>
<span class="sd">    In future however, selected transformations may inherit fields from</span>
<span class="sd">    the parent.</span>

<span class="sd">    While Field class instances are usually created automatically by the</span>
<span class="sd">    :func:`Geometry.addField` method of some Geometry,</span>
<span class="sd">    it is possible to create Field</span>
<span class="sd">    instances yourself and manage the objects like you want. The Fields</span>
<span class="sd">    stored inside Geometry objects have some special features though,</span>
<span class="sd">    like being exported to a PGF file together with the geometry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry: :class:`Formex` | :class:`Mesh`</span>
<span class="sd">        Describes the geometrical domain over which the field is defined.</span>
<span class="sd">        Currently this has to be an instance of :class:`Formex` or</span>
<span class="sd">        :class:`Mesh` (or a subclass thereof).</span>
<span class="sd">    fldtype: str</span>
<span class="sd">        The field type, one of the following predefined strings:</span>

<span class="sd">        - &#39;node&#39;: the field data are specified at the nodes of the geometry;</span>
<span class="sd">        - &#39;elemc&#39;: the field data are constant per element;</span>
<span class="sd">        - &#39;elemn&#39;: the field data vary over the element and are specified at</span>
<span class="sd">          the nodes of the elements;</span>
<span class="sd">        - &#39;elemg&#39;: the field data are specified at a number of points of</span>
<span class="sd">          the elements, from which they can be inter- or extrapolated;</span>

<span class="sd">        The actually available field types depend on the type of the</span>
<span class="sd">        `geometry` object. :class:`Formex` type has only &#39;elemc&#39; and &#39;elemn&#39;.</span>
<span class="sd">        `Mesh` currently has &#39;node&#39;, &#39;elemc&#39; and &#39;elemn&#39;.</span>
<span class="sd">    data`: :term:`array_like`</span>
<span class="sd">        An array with the field values defined at the specified</span>
<span class="sd">        points. The required shape of the array depends on `fldtype`:</span>

<span class="sd">        - &#39;node&#39;:  ( nnodes, ) or ( nnodes, nval )</span>
<span class="sd">        - &#39;elemc&#39;: ( nelems, ) or ( nelems, nval )</span>
<span class="sd">        - &#39;elemn&#39;: ( nelems, nplex ) or  (nelems, nplex, nval )</span>
<span class="sd">        - &#39;elemg&#39;: ( nelems, ngp ) or  (nelems, ngp, nval )</span>
<span class="sd">    fldname: str, optional</span>
<span class="sd">        The name used to identify the field. Fields stored in a Geometry</span>
<span class="sd">        object can be retrieved using this name. See :func:`Geometry.getField`.</span>
<span class="sd">        If no name is specified, an automatic name is generated.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyformex.formex import Formex</span>
<span class="sd">    &gt;&gt;&gt; M = Formex(&#39;4:0123&#39;).replic(2).toMesh()</span>
<span class="sd">    &gt;&gt;&gt; print(M.coords)</span>
<span class="sd">    [[0. 0. 0.]</span>
<span class="sd">     [0. 1. 0.]</span>
<span class="sd">     [1. 0. 0.]</span>
<span class="sd">     [1. 1. 0.]</span>
<span class="sd">     [2. 0. 0.]</span>
<span class="sd">     [2. 1. 0.]]</span>
<span class="sd">    &gt;&gt;&gt; print(M.elems)</span>
<span class="sd">    [[0 2 3 1]</span>
<span class="sd">     [2 4 5 3]]</span>
<span class="sd">    &gt;&gt;&gt; d = M.coords.distanceFromPlane([0.,0.,0.],[1.,0.,0.])</span>
<span class="sd">    &gt;&gt;&gt; f1 = Field(M,&#39;node&#39;,d)</span>
<span class="sd">    &gt;&gt;&gt; print(f1)</span>
<span class="sd">    Field &#39;field-0&#39;, type &#39;node&#39;, shape (6,), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [0. 0. 1. 1. 2. 2.]</span>
<span class="sd">    &gt;&gt;&gt; f2 = f1.convert(&#39;elemn&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(f2)</span>
<span class="sd">    Field &#39;field-1&#39;, type &#39;elemn&#39;, shape (2, 4), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[0. 1. 1. 0.]</span>
<span class="sd">     [1. 2. 2. 1.]]</span>
<span class="sd">    &gt;&gt;&gt; f3 = f2.convert(&#39;elemc&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(f3)</span>
<span class="sd">    Field &#39;field-2&#39;, type &#39;elemc&#39;, shape (2,), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [0.5 1.5]</span>
<span class="sd">    &gt;&gt;&gt; d1 = M.coords.distanceFromPlane([0.,0.,0.],[0.,1.,0.])</span>
<span class="sd">    &gt;&gt;&gt; f4 = Field(M,&#39;node&#39;,np.column_stack([d,d1]))</span>
<span class="sd">    &gt;&gt;&gt; print(f4)</span>
<span class="sd">    Field &#39;field-3&#39;, type &#39;node&#39;, shape (6, 2), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[0. 0.]</span>
<span class="sd">     [0. 1.]</span>
<span class="sd">     [1. 0.]</span>
<span class="sd">     [1. 1.]</span>
<span class="sd">     [2. 0.]</span>
<span class="sd">     [2. 1.]]</span>
<span class="sd">    &gt;&gt;&gt; f5 = f4.convert(&#39;elemn&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(f5)</span>
<span class="sd">    Field &#39;field-4&#39;, type &#39;elemn&#39;, shape (2, 4, 2), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[[0. 0.]</span>
<span class="sd">      [1. 0.]</span>
<span class="sd">      [1. 1.]</span>
<span class="sd">      [0. 1.]]</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">     [[1. 0.]</span>
<span class="sd">      [2. 0.]</span>
<span class="sd">      [2. 1.]</span>
<span class="sd">      [1. 1.]]]</span>
<span class="sd">    &gt;&gt;&gt; f6 = f5.convert(&#39;elemc&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(f6)</span>
<span class="sd">    Field &#39;field-5&#39;, type &#39;elemc&#39;, shape (2, 2), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[0.5 0.5]</span>
<span class="sd">     [1.5 0.5]]</span>
<span class="sd">    &gt;&gt;&gt; print(f3.convert(&#39;elemn&#39;))</span>
<span class="sd">    Field &#39;field-6&#39;, type &#39;elemn&#39;, shape (2, 4), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[0.5 0.5 0.5 0.5]</span>
<span class="sd">     [1.5 1.5 1.5 1.5]]</span>
<span class="sd">    &gt;&gt;&gt; print(f3.convert(&#39;node&#39;))</span>
<span class="sd">    Field &#39;field-8&#39;, type &#39;node&#39;, shape (6, 1), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[0.5]</span>
<span class="sd">     [0.5]</span>
<span class="sd">     [1. ]</span>
<span class="sd">     [1. ]</span>
<span class="sd">     [1.5]</span>
<span class="sd">     [1.5]]</span>
<span class="sd">    &gt;&gt;&gt; print(f6.convert(&#39;elemn&#39;))</span>
<span class="sd">    Field &#39;field-9&#39;, type &#39;elemn&#39;, shape (2, 4, 2), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[[0.5 0.5]</span>
<span class="sd">      [0.5 0.5]</span>
<span class="sd">      [0.5 0.5]</span>
<span class="sd">      [0.5 0.5]]</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">     [[1.5 0.5]</span>
<span class="sd">      [1.5 0.5]</span>
<span class="sd">      [1.5 0.5]</span>
<span class="sd">      [1.5 0.5]]]</span>
<span class="sd">    &gt;&gt;&gt; print(f6.convert(&#39;node&#39;))</span>
<span class="sd">    Field &#39;field-11&#39;, type &#39;node&#39;, shape (6, 2), nnodes=6, nelems=2, nplex=4</span>
<span class="sd">    [[0.5 0.5]</span>
<span class="sd">     [0.5 0.5]</span>
<span class="sd">     [1.  0.5]</span>
<span class="sd">     [1.  0.5]</span>
<span class="sd">     [1.5 0.5]</span>
<span class="sd">     [1.5 0.5]]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_autoname</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">autoName</span><span class="p">(</span><span class="s1">&#39;Field&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">fldtype</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fldname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a Field.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="s1">&#39;fieldtypes&#39;</span><span class="p">)</span> <span class="ow">or</span>\
           <span class="n">fldtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">fieldtypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can not add field of type &#39;</span><span class="si">{</span><span class="n">fldtype</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;to a </span><span class="si">{</span><span class="n">geometry</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fldtype</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="n">datashape</span> <span class="o">=</span> <span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">nnodes</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fldtype</span> <span class="o">==</span> <span class="s1">&#39;elemc&#39;</span><span class="p">:</span>
            <span class="n">datashape</span> <span class="o">=</span> <span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">nelems</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fldtype</span> <span class="o">==</span> <span class="s1">&#39;elemn&#39;</span><span class="p">:</span>
            <span class="n">datashape</span> <span class="o">=</span> <span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">nelems</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">.</span><span class="n">nplex</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fldtype</span> <span class="o">==</span> <span class="s1">&#39;elemg&#39;</span><span class="p">:</span>
            <span class="n">datashape</span> <span class="o">=</span> <span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">nelems</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">scalar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">datashape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scalar</span><span class="p">:</span>
            <span class="n">datashape</span> <span class="o">=</span> <span class="n">datashape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">checkArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">datashape</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fldname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fldname</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">Field</span><span class="o">.</span><span class="n">_autoname</span><span class="p">)</span>

        <span class="c1"># All data seem OK, store them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fldname</span> <span class="o">=</span> <span class="n">fldname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fldtype</span> <span class="o">=</span> <span class="n">fldtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span> <span class="o">=</span> <span class="n">scalar</span>


<div class="viewcode-block" id="Field.comp"><a class="viewcode-back" href="../ref/field.html#field.Field.comp">[docs]</a>    <span class="k">def</span> <span class="nf">comp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the data component i of a vectorial Field.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i: int:</span>
<span class="sd">            Component index of a vectorial Field. If the Field is a</span>
<span class="sd">            scalar one, any value will return the full scalar data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array</span>
<span class="sd">            An array with scalar data over the Geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Field.convert"><a class="viewcode-back" href="../ref/field.html#field.Field.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totype</span><span class="p">,</span> <span class="n">toname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a Field to another type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        totype: str</span>
<span class="sd">            The target field type. Can be any of the available</span>
<span class="sd">            field types. See :class:`Field` class. If the target type is equal</span>
<span class="sd">            to the source type, a copy of the original Field will result.</span>
<span class="sd">            This may or may not be a shallow copy.</span>

<span class="sd">        toname: str</span>
<span class="sd">            The name of the target field. If not specified,</span>
<span class="sd">            a autoname is generated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Field</span>
<span class="sd">            A Field of type `totype` with data converted from the input Field.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">totype</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fldtype</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="n">totype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">fieldtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fldtype</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">totype</span> <span class="o">==</span> <span class="s1">&#39;elemn&#39;</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">elems</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">totype</span> <span class="o">==</span> <span class="s1">&#39;elemc&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;elemn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;elemc&#39;</span><span class="p">,</span> <span class="n">toname</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fldtype</span> <span class="o">==</span> <span class="s1">&#39;elemn&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">totype</span> <span class="o">==</span> <span class="s1">&#39;elemc&#39;</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">totype</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">nodalAvg</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nnodes</span><span class="p">()</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fldtype</span> <span class="o">==</span> <span class="s1">&#39;elemc&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">totype</span> <span class="o">==</span> <span class="s1">&#39;elemn&#39;</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">multiplex</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nplex</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">totype</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;elemn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">toname</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can not convert </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;field data from &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fldtype</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">totype</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">totype</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">toname</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="sa">f</span><span class="s2">&quot;Field &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fldname</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;type &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fldtype</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;nnodes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nnodes</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;nelems=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nelems</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;nplex=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nplex</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>


<span class="c1"># End</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 3.3 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &gt;</li>
        <!--li class="nav-item nav-item-this"><a href="">field</a></li--> 
      </ul>
    </div>
    <div class="footer">
    <span class="left">
        &copy; Copyright 2004-2023, Benedict Verhegghe.
    </span>
      Last updated on Mar 27, 2023.
    <span class="right">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.4.3.
    </span>
    </div>
  </body>
</html>