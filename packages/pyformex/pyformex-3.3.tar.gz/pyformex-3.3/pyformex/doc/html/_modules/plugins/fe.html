

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!--
##
##  This file is part of the pyFormex project.
##  pyFormex is a tool for generating, manipulating and transforming 3D
##  geometrical models by sequences of mathematical operations.
##  Home page: http://pyformex.org
##  Project page:  http://savannah.nongnu.org/projects/pyformex/
##  Copyright (C) Benedict Verhegghe (benedict.verhegghe@ugent.be)
##  Distributed under the GNU General Public License version 3 or later.
##
##
##  This program is free software: you can redistribute it and/or modify
##  it under the terms of the GNU General Public License as published by
##  the Free Software Foundation, either version 3 of the License, or
##  (at your option) any later version.
##
##  This program is distributed in the hope that it will be useful,
##  but WITHOUT ANY WARRANTY; without even the implied warranty of
##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
##  GNU General Public License for more details.
##
##  You should have received a copy of the GNU General Public License
##  along with this program.  If not, see http://www.gnu.org/licenses/.
##
-->
    <title>plugins.fe &#8212; pyFormex 3.3 documentation</title>

    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pyformex.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="icon" type="image/png" href="../../_static/pyformex_fav.png" />

  </head><body>

<div class="header">
  <a href="http://pyformex.org">
  <img src="../../_static/scallop_dome_small.png" alt="scallop dome" border="0" hspace="20" vspace="12" align="left" />
  <img src="../../_static/pyformex-logo-2.png" alt="pyformex logo" border="0" hspace="10" vspace="8" align="left" />
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyFormex 3.3 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &gt;</li>
        <!--li class="nav-item nav-item-this"><a href="">plugins.fe</a></li--> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<!-- PYFORMEX_SIDEBAR_LOGO -->
<!-- PYFORMEX_WEBSITE_SIDEBAR_TOP -->

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for plugins.fe</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1">##</span>
<span class="c1">##  SPDX-FileCopyrightText: Â© 2007-2023 Benedict Verhegghe &lt;bverheg@gmail.com&gt;</span>
<span class="c1">##  SPDX-License-Identifier: GPL-3.0-or-later</span>
<span class="c1">##</span>
<span class="c1">##  This file is part of pyFormex 3.3  (Sun Mar 26 20:16:15 CEST 2023)</span>
<span class="c1">##  pyFormex is a tool for generating, manipulating and transforming 3D</span>
<span class="c1">##  geometrical models by sequences of mathematical operations.</span>
<span class="c1">##  Home page: https://pyformex.org</span>
<span class="c1">##  Project page: https://savannah.nongnu.org/projects/pyformex/</span>
<span class="c1">##  Development: https://gitlab.com/bverheg/pyformex</span>
<span class="c1">##  Distributed under the GNU General Public License version 3 or later.</span>
<span class="c1">##</span>
<span class="c1">##  This program is free software: you can redistribute it and/or modify</span>
<span class="c1">##  it under the terms of the GNU General Public License as published by</span>
<span class="c1">##  the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">##  (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1">##  This program is distributed in the hope that it will be useful,</span>
<span class="c1">##  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">##  GNU General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1">##  You should have received a copy of the GNU General Public License</span>
<span class="c1">##  along with this program.  If not, see http://www.gnu.org/licenses/.</span>
<span class="c1">##</span>
<span class="sd">&quot;&quot;&quot;Finite Element Models in pyFormex.</span>

<span class="sd">Finite element models are geometrical models that consist of a unique</span>
<span class="sd">set of nodal coordinates and one of more sets of elements.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pyformex</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">pyformex</span> <span class="kn">import</span> <span class="n">arraytools</span> <span class="k">as</span> <span class="n">at</span>
<span class="kn">from</span> <span class="nn">pyformex.coords</span> <span class="kn">import</span> <span class="n">Coords</span>
<span class="kn">from</span> <span class="nn">pyformex.connectivity</span> <span class="kn">import</span> <span class="n">Connectivity</span>
<span class="kn">from</span> <span class="nn">pyformex.mesh</span> <span class="kn">import</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">mergeMeshes</span>
<span class="kn">from</span> <span class="nn">pyformex.elements</span> <span class="kn">import</span> <span class="n">Elems</span>


<span class="c1">######################## Finite Element Model ##########################</span>


<div class="viewcode-block" id="FEModel"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel">[docs]</a><span class="k">class</span> <span class="nc">FEModel</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A base class for a Finite Element Model.</span>

<span class="sd">    An FEModel is a collection of :class:`Mesh` instances which share a</span>
<span class="sd">    single set of nodes.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ..formex import Formex</span>
<span class="sd">    &gt;&gt;&gt; M0 = Formex(&#39;4:01234412&#39;).toMesh().setProp(1)</span>
<span class="sd">    &gt;&gt;&gt; M1 = Formex(&#39;3:027138&#39;).toMesh().setProp(2)</span>
<span class="sd">    &gt;&gt;&gt; FEM = FEModel([M0,M1])</span>
<span class="sd">    Finite Element Model</span>
<span class="sd">    Number of nodes: 7</span>
<span class="sd">    Number of elements: 4</span>
<span class="sd">    Number of element groups: 2</span>
<span class="sd">    Number of elements per group: [2, 2]</span>
<span class="sd">    Plexitude of each group: [4, 3]</span>
<span class="sd">    &gt;&gt;&gt; print(FEM.celems)</span>
<span class="sd">    [0 2 4]</span>
<span class="sd">    &gt;&gt;&gt; print(FEM.coords)</span>
<span class="sd">    [[ 0. -1.  0.]</span>
<span class="sd">     [ 1. -1.  0.]</span>
<span class="sd">     [-1.  0.  0.]</span>
<span class="sd">     [ 0.  0.  0.]</span>
<span class="sd">     [ 1.  0.  0.]</span>
<span class="sd">     [ 0.  1.  0.]</span>
<span class="sd">     [ 1.  1.  0.]]</span>
<span class="sd">    &gt;&gt;&gt; for e in FEM.elems: print(repr(e))</span>
<span class="sd">    Elems([[3, 4, 6, 5],</span>
<span class="sd">           [3, 0, 1, 4]], eltype=Quad4)</span>
<span class="sd">    Elems([[3, 5, 2],</span>
<span class="sd">           [3, 2, 0]], eltype=Tri3)</span>
<span class="sd">    &gt;&gt;&gt; for p in FEM.props(): print(p)</span>
<span class="sd">    [1 1]</span>
<span class="sd">    [2 2]</span>
<span class="sd">    &gt;&gt;&gt; for M in FEM.meshes(): print(M)</span>
<span class="sd">    Mesh: nnodes: 7, nelems: 2, nplex: 4, level: 2, eltype: quad4</span>
<span class="sd">      BBox: [-1. -1.  0.], [1. 1. 0.]</span>
<span class="sd">      Size: [2. 2. 0.]</span>
<span class="sd">      Length: 6.0  Area: 2.0</span>
<span class="sd">    Mesh: nnodes: 7, nelems: 2, nplex: 3, level: 2, eltype: tri3</span>
<span class="sd">      BBox: [-1. -1.  0.], [1. 1. 0.]</span>
<span class="sd">      Size: [2. 2. 0.]</span>
<span class="sd">      Length: 4.82...  Area: 1.0</span>
<span class="sd">    &gt;&gt;&gt; glo, loc = FEM.splitElems([0,1,2])</span>
<span class="sd">    &gt;&gt;&gt; print(glo)</span>
<span class="sd">    [array([0, 1]), array([2])]</span>
<span class="sd">    &gt;&gt;&gt; print(loc)</span>
<span class="sd">    [array([0, 1]), array([0])]</span>
<span class="sd">    &gt;&gt;&gt; FEM.elemNrs(1,[0,1])</span>
<span class="sd">    array([2, 3])</span>
<span class="sd">    &gt;&gt;&gt; FEM.getElems([[], [0,1]])</span>
<span class="sd">    [Elems([], shape=(0, 4), eltype=Quad4), Elems([[3, 5, 2],</span>
<span class="sd">           [3, 2, 0]], eltype=Tri3)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meshes</span><span class="p">,</span> <span class="n">fuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new FEModel.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">meshes</span> <span class="o">=</span> <span class="p">[</span><span class="n">meshes</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected a Mesh or a list thereof.&quot;</span><span class="p">)</span>

        <span class="n">nnodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">nnodes</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">]</span>
        <span class="n">nelems</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">nelems</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">]</span>
        <span class="n">nplex</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">nplex</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">]</span>
        <span class="n">coords</span><span class="p">,</span> <span class="n">elems</span> <span class="o">=</span> <span class="n">mergeMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">fuse</span><span class="o">=</span><span class="n">fuse</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">prop</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">m</span><span class="o">.</span><span class="n">toProp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">]</span>
        <span class="c1"># Store the info</span>
        <span class="c1"># We do not store the Meshes, to keep coords/elems info mutable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elems</span> <span class="o">=</span> <span class="n">elems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="c1"># Store info to translate node/element numbers from Mesh to FEModel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">nnodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">celems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">nelems</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finite Element Model&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of nodes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of elements: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">celems</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of element groups: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">nelems</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of elements per group: </span><span class="si">{</span><span class="n">nelems</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plexitude of each group: </span><span class="si">{</span><span class="n">nplex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="FEModel.nelems"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.nelems">[docs]</a>    <span class="k">def</span> <span class="nf">nelems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the total number of elements in the model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">celems</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="FEModel.nnodes"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.nnodes">[docs]</a>    <span class="k">def</span> <span class="nf">nnodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the total number of nodes in the model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="FEModel.ngroups"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.ngroups">[docs]</a>    <span class="k">def</span> <span class="nf">ngroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the number of element groups in the model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elems</span><span class="p">)</span></div>

<div class="viewcode-block" id="FEModel.mplex"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.mplex">[docs]</a>    <span class="k">def</span> <span class="nf">mplex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the plexitude of all the element groups in the model.</span>

<span class="sd">        Returns a list of integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">nplex</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems</span><span class="p">]</span></div>


<div class="viewcode-block" id="FEModel.props"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.props">[docs]</a>    <span class="k">def</span> <span class="nf">props</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the individual prop arrays for all element groups.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of int arrays</span>
<span class="sd">            A list with the prop array for each of the element groups</span>
<span class="sd">            in the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span>
                <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">celems</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">celems</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span></div>


<div class="viewcode-block" id="FEModel.meshes"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.meshes">[docs]</a>    <span class="k">def</span> <span class="nf">meshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the element groups as a list of separate Meshes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sel: int :term:`array_like`</span>
<span class="sd">            The list of global element numbers to be included in the output.</span>
<span class="sd">            The default is to include all elements.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of :class:`Mesh`</span>
<span class="sd">            A list with the Meshes corresponding with the (possibly partial)</span>
<span class="sd">            element groups in the model. The Meshes are not compacted and</span>
<span class="sd">            may be empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems</span>
            <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitElems</span><span class="p">(</span><span class="n">sel</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElems</span><span class="p">(</span><span class="n">elist</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProps</span><span class="p">(</span><span class="n">elist</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elems</span><span class="p">,</span> <span class="n">props</span><span class="p">)]</span></div>


<div class="viewcode-block" id="FEModel.splitElems"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.splitElems">[docs]</a>    <span class="k">def</span> <span class="nf">splitElems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Splits a list of element numbers over the element groups.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sel: int :term:`array_like`, optional.</span>
<span class="sd">            A list of global element numbers. All values should be in the</span>
<span class="sd">            range 0..self.nelems(). If not provided, the list of all elements</span>
<span class="sd">            is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        global: lists of int arrays</span>
<span class="sd">            A list with the global element numbers from the input that</span>
<span class="sd">            belong to each of the groups.</span>
<span class="sd">        local: list of int arrays</span>
<span class="sd">            A list with the local (group) element numbers corresponding</span>
<span class="sd">            with the returned global numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nelems</span><span class="p">())</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">split</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">celems</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">split</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">return</span> <span class="n">split</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">ofs</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ofs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">celems</span><span class="p">)]</span></div>


<div class="viewcode-block" id="FEModel.elemNrs"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.elemNrs">[docs]</a>    <span class="k">def</span> <span class="nf">elemNrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">elems</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the global element numbers for given local group numbers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        group: int</span>
<span class="sd">            The group number</span>
<span class="sd">        elems: int :term:`array_like`</span>
<span class="sd">            A list of local element numbers from the specified group.</span>
<span class="sd">            If omitted, the list of all the elements in that group is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int array</span>
<span class="sd">            A list with global element numbers corresponding with input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">elems</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elems</span><span class="p">[</span><span class="n">group</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">celems</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">+</span> <span class="n">elems</span></div>


<div class="viewcode-block" id="FEModel.getElems"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.getElems">[docs]</a>    <span class="k">def</span> <span class="nf">getElems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the definitions of selected elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sel: list of int :term:`array_like`</span>
<span class="sd">            A list with for each element group the list of local element</span>
<span class="sd">            numbers to be included in the output.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of :class:`~elements.Elems`</span>
<span class="sd">            The connectivity table of the selected elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elems</span><span class="p">,</span> <span class="n">sel</span><span class="p">)]</span></div>


<div class="viewcode-block" id="FEModel.getProps"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.getProps">[docs]</a>    <span class="k">def</span> <span class="nf">getProps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the prop values of selected elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sel: list of int :term:`array_like`</span>
<span class="sd">            A list with for each element group the list of local element</span>
<span class="sd">            numbers to be included in the output.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of int arrays</span>
<span class="sd">            The prop values of the selected elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">(),</span> <span class="n">sel</span><span class="p">)]</span></div>


<div class="viewcode-block" id="FEModel.renumber"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.FEModel.renumber">[docs]</a>    <span class="k">def</span> <span class="nf">renumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renumber a set of nodes.</span>

<span class="sd">        old and new are equally sized lists with unique node numbers, all</span>
<span class="sd">        smaller than the number of nodes in the model.</span>
<span class="sd">        The old numbers will be renumbered to the new numbers.</span>
<span class="sd">        If one of the lists is None, a range with the length of the</span>
<span class="sd">        other is used.</span>
<span class="sd">        If the lists are shorter than the number of nodes, the remaining</span>
<span class="sd">        nodes will be numbered in an unspecified order.</span>
<span class="sd">        If both lists are None, the nodes are renumbered randomly.</span>

<span class="sd">        This function returns a tuple (old,new) with the full renumbering</span>
<span class="sd">        vectors used. The first gives the old node numbers of the current</span>
<span class="sd">        numbers, the second gives the new numbers corresponding with the</span>
<span class="sd">        old ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnodes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nnodes</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nnodes</span><span class="p">))</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nnodes</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nnodes</span><span class="p">))</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">old</span><span class="p">[:</span><span class="n">nn</span><span class="p">]</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">new</span><span class="p">[:</span><span class="n">nn</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">old</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">at</span><span class="o">.</span><span class="n">checkUniqueNumbers</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nnodes</span><span class="p">)</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">old</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">at</span><span class="o">.</span><span class="n">checkUniqueNumbers</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nnodes</span><span class="p">)</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="nb">all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nnodes</span><span class="p">)</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">old</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="nb">all</span><span class="p">,</span> <span class="n">old</span><span class="p">)])</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="nb">all</span><span class="p">,</span> <span class="n">new</span><span class="p">)])</span>
        <span class="n">oldnew</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span><span class="n">new</span><span class="p">]</span>
        <span class="n">newold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">oldnew</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">oldnew</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elems</span> <span class="o">=</span> <span class="p">[</span><span class="n">Connectivity</span><span class="p">(</span><span class="n">newold</span><span class="p">[</span><span class="n">e</span><span class="p">],</span> <span class="n">eltype</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">eltype</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">oldnew</span><span class="p">,</span> <span class="n">newold</span></div></div>


<div class="viewcode-block" id="mergedModel"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.mergedModel">[docs]</a><span class="nd">@utils</span><span class="o">.</span><span class="n">deprecated_by</span><span class="p">(</span><span class="s1">&#39;fe.mergedModel&#39;</span><span class="p">,</span> <span class="s1">&#39;fe.FEModel&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mergedModel</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the fe Model obtained from merging individual meshes.</span>

<span class="sd">    The input arguments are (coords,elems) tuples.</span>
<span class="sd">    The return value is a merged fe Model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FEModel</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../ref/plugins.fe.html#plugins.fe.Model">[docs]</a><span class="k">def</span> <span class="nf">Model</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fuse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create an FEModel from a single Coords and multiple Elems.</span>

<span class="sd">    This is a convenience function to create an FEModel from a single</span>
<span class="sd">    Coords block and a list of Elems, and avoid the fusing and renumbering</span>
<span class="sd">    of the nodes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coords: Coords</span>
<span class="sd">        A single block of nodes shared by all the meshes in the model.</span>
<span class="sd">    elems: list of Elems</span>
<span class="sd">        A list of element connectivity tables, that can have different</span>
<span class="sd">        element types.</span>
<span class="sd">    prop: list of prop</span>
<span class="sd">        A list of prop arrays for the meshes. If props are specified,</span>
<span class="sd">        they need to be given for all the meshes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;meshes&#39;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The use of the &#39;meshes&#39; argument in fe.Model &quot;</span>
                         <span class="s2">&quot;is forbidden. Use fe.FEModel instead.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elems</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">elems</span> <span class="o">=</span> <span class="p">[</span><span class="n">elems</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">Coords</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">Coords</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="n">elems</span> <span class="o">=</span> <span class="p">[</span><span class="n">Elems</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">eltype</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">eltype</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elems</span><span class="p">]</span>
    <span class="n">meshes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elems</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">prop</span> <span class="ow">and</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
        <span class="n">meshes</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">setProp</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">prop</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">FEModel</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">fuse</span><span class="o">=</span><span class="n">fuse</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>



<span class="c1"># End</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyFormex 3.3 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &gt;</li>
        <!--li class="nav-item nav-item-this"><a href="">plugins.fe</a></li--> 
      </ul>
    </div>
    <div class="footer">
    <span class="left">
        &copy; Copyright 2004-2023, Benedict Verhegghe.
    </span>
      Last updated on Mar 27, 2023.
    <span class="right">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.4.3.
    </span>
    </div>
  </body>
</html>