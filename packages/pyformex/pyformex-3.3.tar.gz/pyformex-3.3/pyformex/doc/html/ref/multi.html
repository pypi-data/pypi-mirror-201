

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!--
##
##  This file is part of the pyFormex project.
##  pyFormex is a tool for generating, manipulating and transforming 3D
##  geometrical models by sequences of mathematical operations.
##  Home page: http://pyformex.org
##  Project page:  http://savannah.nongnu.org/projects/pyformex/
##  Copyright (C) Benedict Verhegghe (benedict.verhegghe@ugent.be)
##  Distributed under the GNU General Public License version 3 or later.
##
##
##  This program is free software: you can redistribute it and/or modify
##  it under the terms of the GNU General Public License as published by
##  the Free Software Foundation, either version 3 of the License, or
##  (at your option) any later version.
##
##  This program is distributed in the hope that it will be useful,
##  but WITHOUT ANY WARRANTY; without even the implied warranty of
##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
##  GNU General Public License for more details.
##
##  You should have received a copy of the GNU General Public License
##  along with this program.  If not, see http://www.gnu.org/licenses/.
##
-->
    <title>29. multi — Framework for multi-processing in pyFormex &#8212; pyFormex 3.3 documentation</title>

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pyformex.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="30. mydict — Extensions to Python’s built-in dict class." href="mydict.html" />
    <link rel="prev" title="28. main — pyFormex main module" href="main.html" />
<link rel="icon" type="image/png" href="../_static/pyformex_fav.png" />

  </head><body>

<div class="header">
  <a href="http://pyformex.org">
  <img src="../_static/scallop_dome_small.png" alt="scallop dome" border="0" hspace="20" vspace="12" align="left" />
  <img src="../_static/pyformex-logo-2.png" alt="pyformex logo" border="0" hspace="10" vspace="8" align="left" />
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="mydict.html" title="30. mydict — Extensions to Python’s built-in dict class."
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="main.html" title="28. main — pyFormex main module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 3.3 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../refman.html" accesskey="U">pyFormex reference manual</a> &gt;</li>
        <!--li class="nav-item nav-item-this"><a href=""><span class="section-number">29. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">multi</span></code> — Framework for multi-processing in pyFormex</a></li--> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<!-- PYFORMEX_SIDEBAR_LOGO -->
<!-- PYFORMEX_WEBSITE_SIDEBAR_TOP -->

  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">29. <code class="xref py py-mod docutils literal notranslate"><span class="pre">multi</span></code> — Framework for multi-processing in pyFormex</a><ul>
<li><a class="reference internal" href="#functions-defined-in-module-multi">29.1. Functions defined in module multi</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="main.html"
                        title="previous chapter"><span class="section-number">28. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">main</span></code> — pyFormex main module</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mydict.html"
                        title="next chapter"><span class="section-number">30. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">mydict</span></code> — Extensions to Python’s built-in dict class.</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-multi">
<span id="multi-framework-for-multi-processing-in-pyformex"></span><span id="sec-ref-multi"></span><h1><span class="section-number">29. </span><a class="reference internal" href="#module-multi" title="multi: Framework for multi-processing in pyFormex"><code class="xref py py-mod docutils literal notranslate"><span class="pre">multi</span></code></a> — Framework for multi-processing in pyFormex<a class="headerlink" href="#module-multi" title="Permalink to this headline">¶</a></h1>
<p>This module contains some functions to perform multiprocessing
in pyFormex in a unified way.</p>
<div class="section" id="functions-defined-in-module-multi">
<h2><span class="section-number">29.1. </span>Functions defined in module multi<a class="headerlink" href="#functions-defined-in-module-multi" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="multi.splitArgs">
<code class="sig-prename descclassname">multi.</code><code class="sig-name descname">splitArgs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">nproc</span><span class="o">=</span><span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">close</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/multi.html#splitArgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#multi.splitArgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Split data blocks over multiple processors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> (list or tuple of <a class="reference internal" href="../glossary.html#term-array_like"><span class="xref std std-term">array_like</span></a>) – A sequence of data blocks that may need to be split for parallel
processing over multiple processors. Splitting is done along the
first dimension, which should therefore be the same for all arrays
in the sequence that need to be split.</p></li>
<li><p><strong>mask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em> or </em><em>tuple of bool</em>) – If provided, this flags the items in <code class="docutils literal notranslate"><span class="pre">args</span></code> that should be split.
The list should have the same length as <code class="docutils literal notranslate"><span class="pre">args</span></code>.
If not provided, all array type items in <code class="docutils literal notranslate"><span class="pre">args</span></code> will be split.</p></li>
<li><p><strong>nproc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – Intended number of processors. If negative (default), it is set equal
to the number of processors detected on the host machine.</p></li>
<li><p><strong>close</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – If True, the elements where the arrays are split are included in both
blocks delimited by the element. Thus splitting an array [1, 2, 3]
in two results in [1, 2] and [2, 3], while the default split would
be [1, 2] and [3].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><em>list of tuples.</em> – The list contains <code class="docutils literal notranslate"><span class="pre">nproc</span></code> tuples and each tuple contains the same
number of items as the input <code class="docutils literal notranslate"><span class="pre">args</span></code> and in the same order, whereby
the (nonmasked) arrays are replaced by a slice of the array along
its first axis, and the masked and non-array items are replicated
as is.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="arraytools.html#arraytools.splitar" title="arraytools.splitar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">arraytools.splitar</span></code></a></dt><dd><p>the low level function used to do the splitting</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">splitArgs</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="s1">&#39;abcde&#39;</span><span class="p">],</span><span class="n">nproc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">[(array([0, 1]), &#39;abcde&#39;), (array([2]), &#39;abcde&#39;), (array([3, 4]), &#39;abcde&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">splitArgs</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="s1">&#39;=&gt;&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span><span class="n">nproc</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="go">[[1. 0. 0. 0. 0.]</span>
<span class="go"> [0. 1. 0. 0. 0.]] =&gt; [0 1]</span>
<span class="go">[[0. 0. 1. 0. 0.]] =&gt; [2]</span>
<span class="go">[[0. 0. 0. 1. 0.]</span>
<span class="go"> [0. 0. 0. 0. 1.]] =&gt; [3 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">splitArgs</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="s1">&#39;=&gt;&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">nproc</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="go">[[1. 0. 0. 0. 0.]</span>
<span class="go"> [0. 1. 0. 0. 0.]] =&gt; [0 1 2 3 4]</span>
<span class="go">[[0. 0. 1. 0. 0.]] =&gt; [0 1 2 3 4]</span>
<span class="go">[[0. 0. 0. 1. 0.]</span>
<span class="go"> [0. 0. 0. 0. 1.]] =&gt; [0 1 2 3 4]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="multi.dofunc">
<code class="sig-prename descclassname">multi.</code><code class="sig-name descname">dofunc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">arg</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/multi.html#dofunc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#multi.dofunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function for the multitask function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>arg</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><em>tuple</em></a>) – The first item of the tuple is a callable. The remaining
items are its arguments.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><em>object</em> – The value of the callable when passed the remaining items as
arguments.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dofunc</span><span class="p">((</span><span class="nb">max</span><span class="p">,(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="go">5</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="multi.multitask">
<code class="sig-prename descclassname">multi.</code><code class="sig-name descname">multitask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tasks</span></em>, <em class="sig-param"><span class="n">nproc</span><span class="o">=</span><span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">_async</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/multi.html#multitask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#multi.multitask" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform tasks in parallel.</p>
<p>Runs a number of tasks in parallel over a number of subprocesses.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tasks</strong> (<em>list of tuples</em>) – Each task in the list is a tuple where the first item is a callable
and the other items are the arguments to be passed to the callable.</p></li>
<li><p><strong>nproc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – The number of subprocesses to be started. This may be
different from the number of tasks to run: processes finishing a
task will pick up a next one. There is no benefit in starting more
processes than the number of tasks or the number of processing units
available. The default will set <code class="docutils literal notranslate"><span class="pre">nproc</span></code> to the minimum of these two
values.</p></li>
<li><p><strong>_async</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – <p>If True (default), the tasks are executed asynchronously and the
results are collected when they are done. This has two benefits:</p>
<ul>
<li><p>multitask can be run in ‘script’ execution mode,</p></li>
<li><p>the tasks can execute external commands (using <a class="reference internal" href="process.html#process.run" title="process.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">process.run()</span></code></a>,
not <a class="reference internal" href="utils.html#utils.system" title="utils.system"><code class="xref py py-func docutils literal notranslate"><span class="pre">utils.system()</span></code></a> or <a class="reference internal" href="utils.html#utils.command" title="utils.command"><code class="xref py py-func docutils literal notranslate"><span class="pre">utils.command()</span></code></a>).</p></li>
</ul>
<p>If False, a small speedup may be obtained for tasks that do not
need _async=True. But since the gain is marginal, this is not made
the default. The use of this option is discouraged. It may be
removed in future.</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError:</strong> – When using _async=False in script mode.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">task1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="fm">__add__</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">multitask</span><span class="p">((</span><span class="n">task1</span><span class="p">,</span> <span class="n">task2</span><span class="p">))</span>
<span class="go">[5, 6]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyformex</span> <span class="kn">import</span> <span class="n">process</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;ls -d .&#39;</span><span class="p">,)),</span> <span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;uname&#39;</span><span class="p">,))]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">multitask</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">_async</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go">.</span>
<span class="go">Linux</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="mydict.html" title="30. mydict — Extensions to Python’s built-in dict class."
             >next</a> |</li>
        <li class="right" >
          <a href="main.html" title="28. main — pyFormex main module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyFormex 3.3 documentation</a> &gt;</li>
          <li class="nav-item nav-item-1"><a href="../refman.html" >pyFormex reference manual</a> &gt;</li>
        <!--li class="nav-item nav-item-this"><a href=""><span class="section-number">29. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">multi</span></code> — Framework for multi-processing in pyFormex</a></li--> 
      </ul>
    </div>
    <div class="footer">
    <span class="left">
        &copy; Copyright 2004-2023, Benedict Verhegghe.
    </span>
      Last updated on Mar 27, 2023.
    <span class="right">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.4.3.
    </span>
    </div>
  </body>
</html>