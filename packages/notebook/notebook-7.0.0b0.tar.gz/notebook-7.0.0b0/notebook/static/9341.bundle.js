"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9341],{39341:(e,t,s)=>{s.r(t),s.d(t,{BreadCrumbs:()=>v,CHUNK_SIZE:()=>Z,DirListing:()=>q,FileBrowser:()=>G,FileBrowserModel:()=>Q,FileDialog:()=>se,FileUploadStatus:()=>ue,FilterFileBrowserModel:()=>te,IDefaultFileBrowser:()=>ae,IFileBrowserCommands:()=>oe,IFileBrowserFactory:()=>ne,LARGE_FILE_SIZE:()=>$,TogglableHiddenFileBrowserModel:()=>ee,Uploader:()=>le});var i=s(23450),r=s(41720),n=s(98836),a=s(14039),o=s(59542),l=s(10806),d=s(21911),h=s(20882),c=s(38e3);const m="jp-BreadCrumbs-home",p="jp-BreadCrumbs-preferred",u="jp-BreadCrumbs-item",_=["/","../../","../",""],g="application/x-jupyter-icontents",f="jp-mod-dropTarget";class v extends o.Widget{constructor(e){super(),this.translator=e.translator||n.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._model=e.model,this.addClass("jp-BreadCrumbs"),this._crumbs=w.createCrumbs(),this._crumbSeps=w.createCrumbSeparators();const t=l.PageConfig.getOption("preferredPath");this._hasPreferred=!(!t||"/"===t),this._hasPreferred&&this.node.appendChild(this._crumbs[w.Crumb.Preferred]),this.node.appendChild(this._crumbs[w.Crumb.Home]),this._model.refreshed.connect(this.update,this)}handleEvent(e){switch(e.type){case"click":this._evtClick(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:return}}onAfterAttach(e){super.onAfterAttach(e),this.update();const t=this.node;t.addEventListener("click",this),t.addEventListener("lm-dragenter",this),t.addEventListener("lm-dragleave",this),t.addEventListener("lm-dragover",this),t.addEventListener("lm-drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node;t.removeEventListener("click",this),t.removeEventListener("lm-dragenter",this),t.removeEventListener("lm-dragleave",this),t.removeEventListener("lm-dragover",this),t.removeEventListener("lm-drop",this)}onUpdateRequest(e){const t=this._model.manager.services.contents.localPath(this._model.path);w.updateCrumbs(this._crumbs,this._crumbSeps,t,this._hasPreferred)}_evtClick(e){if(0!==e.button)return;let t=e.target;for(;t&&t!==this.node;){if(t.classList.contains(p))return this._model.cd(l.PageConfig.getOption("preferredPath")).catch((e=>(0,i.showErrorMessage)(this._trans.__("Open Error"),e))),e.preventDefault(),void e.stopPropagation();if(t.classList.contains(u)||t.classList.contains(m)){const s=h.ArrayExt.findFirstIndex(this._crumbs,(e=>e===t));return this._model.cd(_[s]).catch((e=>(0,i.showErrorMessage)(this._trans.__("Open Error"),e))),e.preventDefault(),void e.stopPropagation()}t=t.parentElement}}_evtDragEnter(e){if(e.mimeData.hasData(g)){const t=h.ArrayExt.findFirstIndex(this._crumbs,(t=>c.ElementExt.hitTest(t,e.clientX,e.clientY)));-1!==t&&t!==w.Crumb.Current&&(this._crumbs[t].classList.add(f),e.preventDefault(),e.stopPropagation())}}_evtDragLeave(e){e.preventDefault(),e.stopPropagation();const t=i.DOMUtils.findElement(this.node,f);t&&t.classList.remove(f)}_evtDragOver(e){e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=i.DOMUtils.findElement(this.node,f);t&&t.classList.remove(f);const s=h.ArrayExt.findFirstIndex(this._crumbs,(t=>c.ElementExt.hitTest(t,e.clientX,e.clientY)));-1!==s&&this._crumbs[s].classList.add(f)}_evtDrop(e){if(e.preventDefault(),e.stopPropagation(),"none"===e.proposedAction)return void(e.dropAction="none");if(!e.mimeData.hasData(g))return;e.dropAction=e.proposedAction;let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(f)){t.classList.remove(f);break}t=t.parentElement}const s=h.ArrayExt.findFirstIndex(this._crumbs,(e=>e===t));if(-1===s)return;const r=this._model,n=l.PathExt.resolve(r.path,_[s]),a=r.manager,o=[],c=e.mimeData.getData(g);for(const e of c){const t=a.services.contents.localPath(e),s=l.PathExt.basename(t),i=l.PathExt.join(n,s);o.push((0,d.renameFile)(a,e,i))}Promise.all(o).catch((e=>(0,i.showErrorMessage)(this._trans.__("Move Error"),e)))}}var w;!function(e){let t;!function(e){e[e.Home=0]="Home",e[e.Ellipsis=1]="Ellipsis",e[e.Parent=2]="Parent",e[e.Current=3]="Current",e[e.Preferred=4]="Preferred"}(t=e.Crumb||(e.Crumb={})),e.updateCrumbs=function(e,s,i,r){const n=e[0].parentNode,a=n.firstChild;for(;a&&a.nextSibling;)n.removeChild(a.nextSibling);r?(n.appendChild(e[t.Home]),n.appendChild(s[0])):n.appendChild(s[0]);const o=i.split("/");if(o.length>2){n.appendChild(e[t.Ellipsis]);const i=o.slice(0,o.length-2).join("/");e[t.Ellipsis].title=i,n.appendChild(s[1])}if(i){if(o.length>=2){e[t.Parent].textContent=o[o.length-2],n.appendChild(e[t.Parent]);const i=o.slice(0,o.length-1).join("/");e[t.Parent].title=i,n.appendChild(s[2])}e[t.Current].textContent=o[o.length-1],n.appendChild(e[t.Current]),e[t.Current].title=i,n.appendChild(s[3])}},e.createCrumbs=function(){const e=a.folderIcon.element({className:m,tag:"span",title:l.PageConfig.getOption("serverRoot")||"Jupyter Server Root",stylesheet:"breadCrumb"}),t=a.ellipsesIcon.element({className:u,tag:"span",stylesheet:"breadCrumb"}),s=document.createElement("span");s.className=u;const i=document.createElement("span");return i.className=u,[e,t,s,i,a.homeIcon.element({className:p,tag:"span",title:l.PageConfig.getOption("preferredPath")||"Jupyter Preferred Path",stylesheet:"breadCrumb"})]},e.createCrumbSeparators=function(){const e=[];for(let t=0;t<4;t++){const t=document.createElement("span");t.textContent="/",e.push(t)}return e}}(w||(w={}));var y=s(82776),b=s(17176),C=s(34787),E=s(30807),D=s(38684),L=s(98215);const x="jp-DirListing-header",k="jp-DirListing-headerItemIcon",I="jp-DirListing-content",P="jp-DirListing-itemText",F="jp-DirListing-itemIcon",N="jp-DirListing-itemModified",M="jp-DirListing-itemFileSize",S="jp-DirListing-checkboxWrapper",T="jp-id-name",j="jp-id-modified",A="jp-id-filesize",O="jp-LastModified-hidden",B="jp-FileSize-hidden",U="application/x-jupyter-icontents",R="jp-mod-dropTarget",V="jp-mod-selected",z="jp-mod-cut",H="jp-mod-multiSelected",K="jp-mod-running",W="jp-mod-descending",Y=!!navigator.platform.match(/Mac/i);class q extends o.Widget{constructor(e){super({node:(e.renderer||q.defaultRenderer).createNode()}),this._items=[],this._sortedItems=[],this._sortState={direction:"ascending",key:"name"},this._onItemOpened=new D.Signal(this),this._drag=null,this._dragData=null,this._selectTimer=-1,this._isCut=!1,this._prevPath="",this._clipboard=[],this._softSelection="",this.selection=Object.create(null),this._searchPrefix="",this._searchPrefixTimer=-1,this._inRename=!1,this._isDirty=!1,this._hiddenColumns=new Set,this.addClass("jp-DirListing"),this.translator=e.translator||n.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._model=e.model,this._model.fileChanged.connect(this._onFileChanged,this),this._model.refreshed.connect(this._onModelRefreshed,this),this._model.pathChanged.connect(this._onPathChanged,this),this._editNode=document.createElement("input"),this._editNode.className="jp-DirListing-editor",this._manager=this._model.manager,this._renderer=e.renderer||q.defaultRenderer;const t=i.DOMUtils.findElement(this.node,x);this._hiddenColumns.add("file_size"),this._renderer.populateHeaderNode(t,this.translator,this._hiddenColumns),this._manager.activateRequested.connect(this._onActivateRequested,this)}dispose(){this._items.length=0,this._sortedItems.length=0,this._clipboard.length=0,super.dispose()}get model(){return this._model}get headerNode(){return i.DOMUtils.findElement(this.node,x)}get contentNode(){return i.DOMUtils.findElement(this.node,I)}get renderer(){return this._renderer}get sortState(){return this._sortState}get onItemOpened(){return this._onItemOpened}selectedItems(){const e=this._sortedItems;return(0,h.filter)(e,(e=>this.selection[e.path]))}sortedItems(){return this._sortedItems[Symbol.iterator]()}sort(e){this._sortedItems=X.sort(this.model.items(),e),this._sortState=e,this.update()}rename(){return this._doRename()}cut(){this._isCut=!0,this._copy(),this.update()}copy(){this._copy()}paste(){if(!this._clipboard.length)return this._isCut=!1,Promise.resolve(void 0);const e=this._model.path,t=[];for(const s of this._clipboard)if(this._isCut){const i=this._manager.services.contents.localPath(s).split("/"),r=i[i.length-1],n=l.PathExt.join(e,r);t.push(this._model.manager.rename(s,n))}else t.push(this._model.manager.copy(s,e));for(const e of this._items)e.classList.remove(z);return this._clipboard.length=0,this._isCut=!1,this.removeClass("jp-mod-clipboard"),Promise.all(t).then((()=>{})).catch((e=>{(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Paste Error"),e)}))}async delete(){const e=this._sortedItems.filter((e=>this.selection[e.path]));if(!e.length)return;const t=1===e.length?this._trans.__("Are you sure you want to permanently delete: %1?",e[0].name):this._trans._n("Are you sure you want to permanently delete the %1 selected item?","Are you sure you want to permanently delete the %1 selected items?",e.length),s=await(0,i.showDialog)({title:this._trans.__("Delete"),body:t,buttons:[i.Dialog.cancelButton({label:this._trans.__("Cancel")}),i.Dialog.warnButton({label:this._trans.__("Delete")})],defaultButton:0});!this.isDisposed&&s.button.accept&&await this._delete(e.map((e=>e.path)))}duplicate(){const e=this._model.path,t=[];for(const s of this.selectedItems())"directory"!==s.type&&t.push(this._model.manager.copy(s.path,e));return Promise.all(t).then((()=>{})).catch((e=>{(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Duplicate file"),e)}))}async download(){await Promise.all(Array.from(this.selectedItems()).filter((e=>"directory"!==e.type)).map((e=>this._model.download(e.path))))}shutdownKernels(){const e=this._model,t=this._sortedItems,s=t.map((e=>e.path)),r=Array.from(this._model.sessions()).filter((e=>{const i=h.ArrayExt.firstIndexOf(s,e.path);return this.selection[t[i].path]})).map((t=>e.manager.services.sessions.shutdown(t.id)));return Promise.all(r).then((()=>{})).catch((e=>{(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Shut down kernel"),e)}))}selectNext(e=!1){let t=-1;const s=Object.keys(this.selection),i=this._sortedItems;if(1===s.length||e){const e=s[s.length-1];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e)),t+=1,t===this._items.length&&(t=0)}else if(0===s.length)t=0;else{const e=s[s.length-1];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e))}-1!==t&&(this._selectItem(t,e),c.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[t]))}selectPrevious(e=!1){let t=-1;const s=Object.keys(this.selection),i=this._sortedItems;if(1===s.length||e){const e=s[0];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e)),t-=1,-1===t&&(t=this._items.length-1)}else if(0===s.length)t=this._items.length-1;else{const e=s[0];t=h.ArrayExt.findFirstIndex(i,(t=>t.path===e))}-1!==t&&(this._selectItem(t,e),c.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[t]))}selectByPrefix(){const e=this._searchPrefix.toLowerCase(),t=this._sortedItems,s=h.ArrayExt.findFirstIndex(t,(t=>t.name.toLowerCase().substr(0,e.length)===e));-1!==s&&(this._selectItem(s,!1),c.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[s]))}isSelected(e){const t=this._sortedItems;return 0!==Array.from((0,h.filter)(t,(t=>t.name===e&&this.selection[t.path]))).length}modelForClick(e){const t=this._sortedItems,s=X.hitTestNodes(this._items,e);if(-1!==s)return t[s]}clearSelectedItems(){this.selection=Object.create(null)}async selectItemByName(e,t=!1){if(await this.model.refresh(),this.isDisposed)throw new Error("File browser is disposed.");const s=this._sortedItems,i=h.ArrayExt.findFirstIndex(s,(t=>t.name===e));if(-1===i)throw new Error("Item does not exist.");this._selectItem(i,!1,t),E.MessageLoop.sendMessage(this,o.Widget.Msg.UpdateRequest),c.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[i])}handleEvent(e){switch(e.type){case"mousedown":this._evtMousedown(e);break;case"mouseup":this._evtMouseup(e);break;case"mousemove":this._evtMousemove(e);break;case"keydown":this.evtKeydown(e);break;case"click":this._evtClick(e);break;case"dblclick":this.evtDblClick(e);break;case"dragenter":case"dragover":this.addClass("jp-mod-native-drop"),e.preventDefault();break;case"dragleave":case"dragend":this.removeClass("jp-mod-native-drop");break;case"drop":this.removeClass("jp-mod-native-drop"),this.evtNativeDrop(e);break;case"scroll":this._evtScroll(e);break;case"lm-dragenter":this.evtDragEnter(e);break;case"lm-dragleave":this.evtDragLeave(e);break;case"lm-dragover":this.evtDragOver(e);break;case"lm-drop":this.evtDrop(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node,s=i.DOMUtils.findElement(t,I);t.addEventListener("mousedown",this),t.addEventListener("keydown",this),t.addEventListener("click",this),t.addEventListener("dblclick",this),s.addEventListener("dragenter",this),s.addEventListener("dragover",this),s.addEventListener("dragleave",this),s.addEventListener("dragend",this),s.addEventListener("drop",this),s.addEventListener("scroll",this),s.addEventListener("lm-dragenter",this),s.addEventListener("lm-dragleave",this),s.addEventListener("lm-dragover",this),s.addEventListener("lm-drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node,s=i.DOMUtils.findElement(t,I);t.removeEventListener("mousedown",this),t.removeEventListener("keydown",this),t.removeEventListener("click",this),t.removeEventListener("dblclick",this),s.removeEventListener("scroll",this),s.removeEventListener("dragover",this),s.removeEventListener("dragover",this),s.removeEventListener("dragleave",this),s.removeEventListener("dragend",this),s.removeEventListener("drop",this),s.removeEventListener("lm-dragenter",this),s.removeEventListener("lm-dragleave",this),s.removeEventListener("lm-dragover",this),s.removeEventListener("lm-drop",this),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0)}onAfterShow(e){this._isDirty&&(this.sort(this.sortState),this.update())}onUpdateRequest(e){var t;this._isDirty=!1;const s=this._sortedItems,r=this._items,n=i.DOMUtils.findElement(this.node,I),a=this._renderer;for(this.removeClass(H),this.removeClass(V);r.length>s.length;)n.removeChild(r.pop());for(;r.length<s.length;){const e=a.createItemNode(this._hiddenColumns);e.classList.add("jp-DirListing-item"),r.push(e),n.appendChild(e)}r.forEach((e=>{e.classList.remove(V),e.classList.remove(K),e.classList.remove(z);const t=a.getCheckboxNode(e);t&&(t.checked=!1)}));const o=a.getCheckboxNode(this.headerNode);if(o){const e=Object.keys(this.selection).length,t=s.length>0&&e===s.length,i=!t&&e>0;o.checked=t,o.indeterminate=i,o.dataset.checked=String(t),o.dataset.indeterminate=String(i);const r=this.translator.load("jupyterlab");null==o||o.setAttribute("aria-label",t||i?r.__("Deselect all files and directories"):r.__("Select all files and directories"))}s.forEach(((e,t)=>{const s=r[t],i=this._manager.registry.getFileTypeForModel(e);a.updateItemNode(s,e,i,this.translator,this._hiddenColumns,this.selection[e.path]),this.selection[e.path]&&this._isCut&&this._model.path===this._prevPath&&s.classList.add(z),s.setAttribute("data-isdir","directory"===e.type?"true":"false")}));const l=Object.keys(this.selection).length;l&&(this.addClass(V),l>1&&this.addClass(H));const d=s.map((e=>e.path));for(const e of this._model.sessions()){const s=h.ArrayExt.firstIndexOf(d,e.path),i=r[s];if(i){let s=null===(t=e.kernel)||void 0===t?void 0:t.name;const r=this._model.specs;if(i.classList.add(K),r&&s){const e=r.kernelspecs[s];s=e?e.display_name:this._trans.__("unknown")}i.title=this._trans.__("%1\nKernel: %2",i.title,s)}}this._prevPath=this._model.path}onResize(e){const{width:t}=-1===e.width?this.node.getBoundingClientRect():e;this.toggleClass("jp-DirListing-narrow",t<250)}setColumnVisibility(e,t){t?this._hiddenColumns.delete(e):this._hiddenColumns.add(e),this.headerNode.innerHTML="",this._renderer.populateHeaderNode(this.headerNode,this.translator,this._hiddenColumns)}isWithinCheckboxHitArea(e){let t=e.target;for(;t;){if(t.classList.contains(S))return!0;t=t.parentElement}return!1}_evtClick(e){const t=e.target,s=this.headerNode,i=this._renderer;if(s.contains(t)){const t=i.getCheckboxNode(s);if(t&&this.isWithinCheckboxHitArea(e))"false"===t.dataset.indeterminate&&"false"===t.dataset.checked?this._sortedItems.forEach((e=>this.selection[e.path]=!0)):this.clearSelectedItems(),this.update();else{const t=this.renderer.handleHeaderClick(s,e);t&&this.sort(t)}}}_evtScroll(e){this.headerNode.scrollLeft=this.contentNode.scrollLeft}_evtMousedown(e){if(e.target===this._editNode)return;if(this._editNode.parentNode){if(this._editNode===e.target)return;this._editNode.focus(),this._editNode.blur(),clearTimeout(this._selectTimer)}let t=X.hitTestNodes(this._items,e);-1!==t&&(this.handleFileSelect(e),0!==e.button&&clearTimeout(this._selectTimer),Y&&e.ctrlKey||2===e.button||0===e.button&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:t},document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)))}_evtMouseup(e){if(this._softSelection&&(e.metaKey||e.shiftKey||e.ctrlKey||0!==e.button||(this.clearSelectedItems(),this.selection[this._softSelection]=!0,this.update()),this._softSelection=""),0===e.button&&this._focusSelectedFile(),0!==e.button||!this._drag)return document.removeEventListener("mousemove",this,!0),void document.removeEventListener("mouseup",this,!0);e.preventDefault(),e.stopPropagation()}_evtMousemove(e){if(e.preventDefault(),e.stopPropagation(),this._drag||!this._dragData)return;const t=this._dragData,s=Math.abs(e.clientX-t.pressX),i=Math.abs(e.clientY-t.pressY);s<5&&i<5||this._startDrag(t.index,e.clientX,e.clientY)}handleOpen(e){if(this._onItemOpened.emit(e),"directory"===e.type){const t=this._manager.services.contents.localPath(e.path);this._model.cd(`/${t}`).catch((e=>(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Open directory"),e)))}else{const t=e.path;this._manager.openOrReveal(t)}}evtKeydown(e){switch(e.keyCode){case 13:{if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return;e.preventDefault(),e.stopPropagation();const t=Object.keys(this.selection)[0],s=this._sortedItems,i=h.ArrayExt.findFirstIndex(s,(e=>e.path===t));if(-1===i)return;const r=this._sortedItems[i];this.handleOpen(r);break}case 38:this.selectPrevious(e.shiftKey),e.stopPropagation(),e.preventDefault();break;case 40:this.selectNext(e.shiftKey),e.stopPropagation(),e.preventDefault()}if(!this._inRename&&void 0!==e.key&&1===e.key.length){if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return;this._searchPrefix+=e.key,clearTimeout(this._searchPrefixTimer),this._searchPrefixTimer=window.setTimeout((()=>{this._searchPrefix=""}),1e3),this.selectByPrefix(),e.stopPropagation(),e.preventDefault()}}evtDblClick(e){if(0!==e.button)return;if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return;if(this.isWithinCheckboxHitArea(e))return;e.preventDefault(),e.stopPropagation(),clearTimeout(this._selectTimer),this._editNode.blur();const t=e.target,s=h.ArrayExt.findFirstIndex(this._items,(e=>e.contains(t)));if(-1===s)return;const i=this._sortedItems[s];this.handleOpen(i)}evtNativeDrop(e){var t,s,r;const n=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;if(!n||0===n.length)return;const a=null===(s=e.dataTransfer)||void 0===s?void 0:s.items.length;if(a){for(let t=0;t<a;t++){let s=null===(r=e.dataTransfer)||void 0===r?void 0:r.items[t].webkitGetAsEntry();(null==s?void 0:s.isDirectory)&&(console.log("currently not supporting drag + drop for folders"),(0,i.showDialog)({title:this._trans.__("Error Uploading Folder"),body:this._trans.__("Drag and Drop is currently not supported for folders"),buttons:[i.Dialog.cancelButton({label:this._trans.__("Close")})]}))}e.preventDefault();for(let e=0;e<n.length;e++)this._model.upload(n[e])}}evtDragEnter(e){if(e.mimeData.hasData(U)){const t=X.hitTestNodes(this._items,e);if(-1===t)return;const s=this._sortedItems[t];if("directory"!==s.type||this.selection[s.path])return;e.target.classList.add(R),e.preventDefault(),e.stopPropagation()}}evtDragLeave(e){e.preventDefault(),e.stopPropagation();const t=i.DOMUtils.findElement(this.node,R);t&&t.classList.remove(R)}evtDragOver(e){e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=i.DOMUtils.findElement(this.node,R);t&&t.classList.remove(R);const s=X.hitTestNodes(this._items,e);this._items[s].classList.add(R)}evtDrop(e){if(e.preventDefault(),e.stopPropagation(),clearTimeout(this._selectTimer),"none"===e.proposedAction)return void(e.dropAction="none");if(!e.mimeData.hasData(U))return;let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(R)){t.classList.remove(R);break}t=t.parentElement}const s=h.ArrayExt.firstIndexOf(this._items,t),r=this._sortedItems;let n=this._model.path;"directory"===r[s].type&&(n=l.PathExt.join(n,r[s].name));const a=this._manager,o=[],c=e.mimeData.getData(U);e.ctrlKey&&"move"===e.proposedAction?e.dropAction="copy":e.dropAction=e.proposedAction;for(const t of c){const s=a.services.contents.localPath(t),i=l.PathExt.basename(s),r=l.PathExt.join(n,i);r!==t&&("copy"===e.dropAction?o.push(a.copy(t,n)):o.push((0,d.renameFile)(a,t,r)))}Promise.all(o).catch((e=>{(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Error while copying/moving files"),e)}))}_startDrag(e,t,s){let i=Object.keys(this.selection);const r=this._items[e],n=this._sortedItems;let a,o;if(r.classList.contains(V)){const e=i[0];o=n.find((t=>t.path===e)),a=this.selectedItems()}else o=n[e],i=[o.path],a=[o];if(!o)return;const l=this._manager.registry.getFileTypeForModel(o),d=this.renderer.createDragImage(r,i.length,this._trans,l);this._drag=new C.Drag({dragImage:d,mimeData:new b.MimeData,supportedActions:"move",proposedAction:"move"}),this._drag.mimeData.setData(U,i);const h=this.model.manager.services;for(const e of a)this._drag.mimeData.setData("application/x-jupyter-icontentsrich",{model:e,withContent:async()=>await h.contents.get(e.path)});if(o&&"directory"!==o.type){const e=i.slice(1).reverse();this._drag.mimeData.setData("application/vnd.lumino.widget-factory",(()=>{if(!o)return;const t=o.path;let s=this._manager.findWidget(t);if(s||(s=this._manager.open(o.path)),e.length){const t=new b.PromiseDelegate;t.promise.then((()=>{let t=s;e.forEach((e=>{const s={ref:null==t?void 0:t.id,mode:"tab-after"};t=this._manager.openOrReveal(e,void 0,void 0,s),this._manager.openOrReveal(o.path)}))})),t.resolve(void 0)}return s}))}document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),clearTimeout(this._selectTimer),this._drag.start(t,s).then((e=>{this._drag=null,clearTimeout(this._selectTimer)}))}handleFileSelect(e){const t=this._sortedItems,s=X.hitTestNodes(this._items,e);if(clearTimeout(this._selectTimer),-1===s)return;this._softSelection="";const i=t[s].path,r=Object.keys(this.selection),n=0===e.button&&!(Y&&e.ctrlKey)&&this.isWithinCheckboxHitArea(e);if(Y&&e.metaKey||!Y&&e.ctrlKey||n)this.selection[i]?delete this.selection[i]:this.selection[i]=!0;else if(e.shiftKey)this._handleMultiSelect(r,s);else{if(!(i in this.selection&&r.length>1))return this._selectItem(s,!1);this._softSelection=i}this.update()}_focusSelectedFile(e){if(void 0===e){const t=Object.keys(this.selection);if(t.length>1)return;e=h.ArrayExt.findFirstIndex(this._sortedItems,(e=>e.path===t[0]))}if(-1===e)return;const t=this._items[e],s=i.DOMUtils.findElement(t,P);s&&s.focus()}_handleMultiSelect(e,t){const s=this._sortedItems;let i=-1;for(let r=0;r<this._items.length;r++){if(r===t)continue;const n=s[r].path;-1!==e.indexOf(n)&&(-1===i||Math.abs(t-r)<Math.abs(i-r))&&(i=r)}-1===i&&(i=0);for(let e=0;e<this._items.length;e++)(i>=e&&t<=e||i<=e&&t>=e)&&(this.selection[s[e].path]=!0)}_copy(){this._clipboard.length=0;for(const e of this.selectedItems())this._clipboard.push(e.path)}async _delete(e){await Promise.all(e.map((e=>this._model.manager.deleteFile(e).catch((e=>{(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Delete Failed"),e)})))))}_doRename(){this._inRename=!0;const e=this._sortedItems,t=Object.keys(this.selection)[0],s=h.ArrayExt.findFirstIndex(e,(e=>e.path===t)),r=this._items[s],n=e[s],a=this.renderer.getNameNode(r),o=n.name;return this._editNode.value=o,this._selectItem(s,!1),X.doRename(a,this._editNode,o).then((e=>{if(this.node.focus(),!e||e===o)return this._inRename=!1,o;if(!(0,d.isValidFileName)(e))return(0,i.showErrorMessage)(this._trans.__("Rename Error"),Error(this._trans._p("showErrorMessage",'"%1" is not a valid name for a file. Names must have nonzero length, and cannot include "/", "\\", or ":"',e))),this._inRename=!1,o;if(this.isDisposed)throw this._inRename=!1,new Error("File browser is disposed.");const t=this._manager,s=l.PathExt.join(this._model.path,o),r=l.PathExt.join(this._model.path,e);return(0,d.renameFile)(t,s,r).catch((e=>("File not renamed"!==e&&(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Rename Error"),e),this._inRename=!1,o))).then((()=>{if(this.isDisposed)throw this._inRename=!1,new Error("File browser is disposed.");return this._inRename&&this.selectItemByName(e),this._inRename=!1,e}))}))}_selectItem(e,t,s=!0){const i=this._sortedItems;t||this.clearSelectedItems();const r=i[e].path;this.selection[r]=!0,!t&&s&&this._focusSelectedFile(e),this.update()}_onModelRefreshed(){const e=Object.keys(this.selection);this.clearSelectedItems();for(const t of this._model.items()){const s=t.path;-1!==e.indexOf(s)&&(this.selection[s]=!0)}this.isVisible?this.sort(this.sortState):this._isDirty=!0}_onPathChanged(){this.clearSelectedItems(),this.sort(this.sortState)}_onFileChanged(e,t){const s=t.newValue;if(!s)return;const i=s.name;"new"===t.type&&i&&this.selectItemByName(i).catch((()=>{}))}_onActivateRequested(e,t){if(l.PathExt.dirname(t)!==this._model.path)return;const s=l.PathExt.basename(t);this.selectItemByName(s).catch((()=>{}))}}var X;!function(e){class t{createNode(){const e=document.createElement("div"),t=document.createElement("div"),s=document.createElement("ul");return s.className=I,t.className=x,e.appendChild(t),e.appendChild(s),e.tabIndex=0,e}populateHeaderNode(e,t,s){const r=(t=t||n.nullTranslator).load("jupyterlab"),a=this.createHeaderItemNode(r.__("Name")),o=document.createElement("div"),l=this.createHeaderItemNode(r.__("Last Modified")),d=this.createHeaderItemNode(r.__("File Size"));if(a.classList.add(T),a.classList.add(V),l.classList.add(j),d.classList.add(A),o.classList.add("jp-id-narrow"),o.textContent="...",!(null==s?void 0:s.has("is_selected"))){const t=this.createCheckboxWrapperNode({alwaysVisible:!0});e.appendChild(t)}e.appendChild(a),e.appendChild(o),e.appendChild(l),e.appendChild(d),(null==s?void 0:s.has("last_modified"))?l.classList.add(O):l.classList.remove(O),(null==s?void 0:s.has("file_size"))?d.classList.add(B):d.classList.remove(B),X.updateCaret(i.DOMUtils.findElement(a,k),"right","up")}handleHeaderClick(e,t){const s=i.DOMUtils.findElement(e,T),r=i.DOMUtils.findElement(e,j),n=i.DOMUtils.findElement(e,A),a={direction:"ascending",key:"name"},o=t.target,l=i.DOMUtils.findElement(r,k),d=i.DOMUtils.findElement(n,k),h=i.DOMUtils.findElement(s,k);return s.contains(o)?(s.classList.contains(V)?s.classList.contains(W)?(s.classList.remove(W),X.updateCaret(h,"right","up")):(a.direction="descending",s.classList.add(W),X.updateCaret(h,"right","down")):(s.classList.remove(W),X.updateCaret(h,"right","up")),s.classList.add(V),r.classList.remove(V),r.classList.remove(W),n.classList.remove(V),n.classList.remove(W),X.updateCaret(l,"left"),X.updateCaret(d,"left"),a):r.contains(o)?(a.key="last_modified",r.classList.contains(V)?r.classList.contains(W)?(r.classList.remove(W),X.updateCaret(l,"left","up")):(a.direction="descending",r.classList.add(W),X.updateCaret(l,"left","down")):(r.classList.remove(W),X.updateCaret(l,"left","up")),r.classList.add(V),s.classList.remove(V),s.classList.remove(W),n.classList.remove(V),n.classList.remove(W),X.updateCaret(h,"right"),X.updateCaret(d,"left"),a):n.contains(o)?(a.key="file_size",n.classList.contains(V)?n.classList.contains(W)?(n.classList.remove(W),X.updateCaret(d,"left","up")):(a.direction="descending",n.classList.add(W),X.updateCaret(d,"left","down")):(n.classList.remove(W),X.updateCaret(d,"left","up")),n.classList.add(V),s.classList.remove(V),s.classList.remove(W),r.classList.remove(V),r.classList.remove(W),X.updateCaret(h,"right"),X.updateCaret(l,"left"),a):a}createItemNode(e){const t=document.createElement("li"),s=document.createElement("span"),i=document.createElement("span"),r=document.createElement("span"),n=document.createElement("span");if(s.className=F,i.className=P,r.className=N,n.className=M,!(null==e?void 0:e.has("is_selected"))){const e=this.createCheckboxWrapperNode();t.appendChild(e)}return t.appendChild(s),t.appendChild(i),t.appendChild(r),t.appendChild(n),i.tabIndex=0,(null==e?void 0:e.has("last_modified"))?r.classList.add(O):r.classList.remove(O),(null==e?void 0:e.has("file_size"))?n.classList.add(B):n.classList.remove(B),t}createCheckboxWrapperNode(e){const t=document.createElement("label");t.classList.add(S),(null==e?void 0:e.alwaysVisible)&&t.classList.add("jp-mod-visible");const s=document.createElement("input");return s.type="checkbox",s.addEventListener("click",(e=>{e.preventDefault()})),t.appendChild(s),t}updateItemNode(e,t,s,r,o,d){d&&e.classList.add(V),s=s||y.DocumentRegistry.getDefaultTextFileType(r);const{icon:c,iconClass:m,name:p}=s,u=(r=r||n.nullTranslator).load("jupyterlab"),_=i.DOMUtils.findElement(e,F),g=i.DOMUtils.findElement(e,P),f=i.DOMUtils.findElement(e,N),v=i.DOMUtils.findElement(e,M),w=i.DOMUtils.findElement(e,S),b=!(null==o?void 0:o.has("is_selected"));if(w&&!b)e.removeChild(w);else if(b&&!w){const t=this.createCheckboxWrapperNode();e.insertBefore(t,_)}(null==o?void 0:o.has("last_modified"))?f.classList.add(O):f.classList.remove(O),(null==o?void 0:o.has("file_size"))?v.classList.add(B):v.classList.remove(B),a.LabIcon.resolveElement({icon:c,iconClass:(0,a.classes)(m,"jp-Icon"),container:_,className:F,stylesheet:"listing"});let C=u.__("Name: %1",t.name);if(null!==t.size&&void 0!==t.size){const e=X.formatFileSize(t.size,1,1024);v.textContent=e,C+=u.__("\nSize: %1",X.formatFileSize(t.size,1,1024))}else v.textContent="";if(t.path){const e=l.PathExt.dirname(t.path);e&&(C+=u.__("\nPath: %1",e.substr(0,50)),e.length>50&&(C+="..."))}t.created&&(C+=u.__("\nCreated: %1",l.Time.format(new Date(t.created)))),t.last_modified&&(C+=u.__("\nModified: %1",l.Time.format(new Date(t.last_modified)))),C+=u.__("\nWritable: %1",t.writable),e.title=C,e.setAttribute("data-file-type",p),t.name.startsWith(".")?e.setAttribute("data-is-dot","true"):e.removeAttribute("data-is-dot");const E=t.indices?t.indices:[];let D=h.StringExt.highlight(t.name,E,L.h.mark);g&&L.VirtualDOM.render(L.h.span(D),g);const x=null==w?void 0:w.querySelector('input[type="checkbox"]');if(x){let e;e="directory"===s.contentType?d?u.__('Deselect directory "%1"',D):u.__('Select directory "%1"',D):d?u.__('Deselect file "%1"',D):u.__('Select file "%1"',D),x.setAttribute("aria-label",e),x.checked=null!=d&&d}let k="",I="";t.last_modified&&(k=l.Time.formatHuman(new Date(t.last_modified)),I=l.Time.format(new Date(t.last_modified))),f.textContent=k,f.title=I}getNameNode(e){return i.DOMUtils.findElement(e,P)}getCheckboxNode(e){return e.querySelector(`.${S} input[type=checkbox]`)}createDragImage(e,t,s,r){const n=e.cloneNode(!0),a=i.DOMUtils.findElement(n,N),o=i.DOMUtils.findElement(n,F);return n.removeChild(a),r?(o.textContent=r.iconLabel||"",o.className=r.iconClass||""):(o.textContent="",o.className=""),o.classList.add("jp-DragIcon"),t>1&&(i.DOMUtils.findElement(n,P).textContent=s._n("%1 Item","%1 Items",t)),n}createHeaderItemNode(e){const t=document.createElement("div"),s=document.createElement("span"),i=document.createElement("span");return t.className="jp-DirListing-headerItem",s.className="jp-DirListing-headerItemText",i.className=k,s.textContent=e,t.appendChild(s),t.appendChild(i),t}}e.Renderer=t,e.defaultRenderer=new t}(q||(q={})),function(e){e.doRename=function(e,t,s){const i=e.parentElement;i.replaceChild(t,e),t.focus();const r=t.value.lastIndexOf(".");return-1===r?t.setSelectionRange(0,t.value.length):t.setSelectionRange(0,r),new Promise(((r,n)=>{t.onblur=()=>{i.replaceChild(e,t),r(t.value)},t.onkeydown=e=>{switch(e.keyCode){case 13:e.stopPropagation(),e.preventDefault(),t.blur();break;case 27:e.stopPropagation(),e.preventDefault(),t.value=s,t.blur();break;case 38:e.stopPropagation(),e.preventDefault(),t.selectionStart!==t.selectionEnd&&(t.selectionStart=t.selectionEnd=0);break;case 40:e.stopPropagation(),e.preventDefault(),t.selectionStart!==t.selectionEnd&&(t.selectionStart=t.selectionEnd=t.value.length)}}}))},e.sort=function(e,t){const s=Array.from(e),i="descending"===t.direction?1:-1;return"last_modified"===t.key?s.sort(((e,t)=>{const s="directory"===e.type?0:1,r="directory"===t.type?0:1,n=new Date(e.last_modified).getTime(),a=new Date(t.last_modified).getTime();return s-r||(n-a)*i})):"file_size"===t.key?s.sort(((e,t)=>{var s,r;return("directory"===e.type?0:1)-("directory"===t.type?0:1)||((null!==(s=e.size)&&void 0!==s?s:0)-(null!==(r=t.size)&&void 0!==r?r:0))*i})):s.sort(((e,t)=>("directory"===e.type?0:1)-("directory"===t.type?0:1)||t.name.localeCompare(e.name)*i)),s},e.hitTestNodes=function(e,t){return h.ArrayExt.findFirstIndex(e,(e=>c.ElementExt.hitTest(e,t.clientX,t.clientY)||t.target===e))},e.formatFileSize=function(e,t,s){if(0===e)return"0 B";const i=t||2,r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(s));return n>=0&&n<r.length?parseFloat((e/Math.pow(s,n)).toFixed(i))+" "+r[n]:String(e)},e.updateCaret=function(e,t,s){s?("down"===s?a.caretDownIcon:a.caretUpIcon).element({container:e,tag:"span",stylesheet:"listingHeaderItem",float:t}):(a.LabIcon.remove(e),e.className=k)}}(X||(X={}));class G extends a.SidePanel{constructor(e){var t;super({content:new o.Panel,translator:e.translator}),this._showLastModifiedColumn=!0,this._showFileSizeColumn=!1,this._showHiddenFiles=!1,this._showFileCheckboxes=!1,this.addClass("jp-FileBrowser"),this.toolbar.addClass("jp-FileBrowser-toolbar"),this.id=e.id;const s=this.translator=null!==(t=e.translator)&&void 0!==t?t:n.nullTranslator,i=this.model=e.model,r=e.renderer;i.connectionFailure.connect(this._onConnectionFailure,this),this._manager=i.manager,this.toolbar.node.setAttribute("role","navigation"),this.toolbar.node.setAttribute("aria-label",this._trans.__("file browser")),this._directoryPending=!1,this.mainPanel=new o.Panel,this.mainPanel.addClass("jp-FileBrowser-Panel"),this.mainPanel.title.label=this._trans.__("File Browser"),this.crumbs=new v({model:i,translator:s}),this.crumbs.addClass("jp-FileBrowser-crumbs"),this.listing=this.createDirListing({model:i,renderer:r,translator:s}),this.listing.addClass("jp-FileBrowser-listing"),this.mainPanel.addWidget(this.crumbs),this.mainPanel.addWidget(this.listing),this.addWidget(this.mainPanel),!1!==e.restore&&i.restore(this.id)}get navigateToCurrentDirectory(){return this._navigateToCurrentDirectory}set navigateToCurrentDirectory(e){this._navigateToCurrentDirectory=e}get showLastModifiedColumn(){return this._showLastModifiedColumn}set showLastModifiedColumn(e){this.listing.setColumnVisibility?(this.listing.setColumnVisibility("last_modified",e),this._showLastModifiedColumn=e):console.warn("Listing does not support toggling column visibility")}get showFileSizeColumn(){return this._showFileSizeColumn}set showFileSizeColumn(e){this.listing.setColumnVisibility?(this.listing.setColumnVisibility("file_size",e),this._showFileSizeColumn=e):console.warn("Listing does not support toggling column visibility")}get showHiddenFiles(){return this._showHiddenFiles}set showHiddenFiles(e){this.model.showHiddenFiles(e),this._showHiddenFiles=e}get showFileCheckboxes(){return this._showFileCheckboxes}set showFileCheckboxes(e){this.listing.setColumnVisibility?(this.listing.setColumnVisibility("is_selected",e),this._showFileCheckboxes=e):console.warn("Listing does not support toggling column visibility")}selectedItems(){return this.listing.selectedItems()}async selectItemByName(e){await this.listing.selectItemByName(e)}clearSelectedItems(){this.listing.clearSelectedItems()}rename(){return this.listing.rename()}cut(){this.listing.cut()}copy(){this.listing.copy()}paste(){return this.listing.paste()}createNewDirectory(){!0!==this._directoryPending&&(this._directoryPending=!0,this._manager.newUntitled({path:this.model.path,type:"directory"}).then((async e=>{await this.listing.selectItemByName(e.name),await this.rename(),this._directoryPending=!1})).catch((e=>{(0,i.showErrorMessage)(this._trans.__("Error"),e),this._directoryPending=!1})))}createNewFile(e){!0!==this._filePending&&(this._filePending=!0,this._manager.newUntitled({path:this.model.path,type:"file",ext:e.ext}).then((async e=>{await this.listing.selectItemByName(e.name),await this.rename(),this._filePending=!1})).catch((e=>{(0,i.showErrorMessage)(this._trans.__("Error"),e),this._filePending=!1})))}delete(){return this.listing.delete()}duplicate(){return this.listing.duplicate()}download(){return this.listing.download()}shutdownKernels(){return this.listing.shutdownKernels()}selectNext(){this.listing.selectNext()}selectPrevious(){this.listing.selectPrevious()}modelForClick(e){return this.listing.modelForClick(e)}createDirListing(e){return new q(e)}_onConnectionFailure(e,t){if(t instanceof r.ServerConnection.ResponseError&&404===t.response.status){const e=this._trans.__("Directory not found");t.message=this._trans.__('Directory not found: "%1"',this.model.path),(0,i.showErrorMessage)(e,t)}}}var J=s(55780);const $=15728640,Z=1048576;class Q{constructor(e){var t;this._connectionFailure=new D.Signal(this),this._fileChanged=new D.Signal(this),this._items=[],this._key="",this._pathChanged=new D.Signal(this),this._paths=new Set,this._pending=null,this._pendingPath=null,this._refreshed=new D.Signal(this),this._sessions=[],this._state=null,this._isDisposed=!1,this._restored=new b.PromiseDelegate,this._uploads=[],this._uploadChanged=new D.Signal(this),this.manager=e.manager,this.translator=e.translator||n.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._driveName=e.driveName||"",this._model={path:this.rootPath,name:l.PathExt.basename(this.rootPath),type:"directory",content:void 0,writable:!1,created:"unknown",last_modified:"unknown",mimetype:"text/plain",format:"text"},this._state=e.state||null;const s=e.refreshInterval||1e4,{services:i}=e.manager;i.contents.fileChanged.connect(this.onFileChanged,this),i.sessions.runningChanged.connect(this.onRunningChanged,this),this._unloadEventListener=e=>{if(this._uploads.length>0){const t=this._trans.__("Files still uploading");return e.returnValue=t,t}},window.addEventListener("beforeunload",this._unloadEventListener),this._poll=new J.Poll({auto:null===(t=e.auto)||void 0===t||t,name:"@jupyterlab/filebrowser:Model",factory:()=>this.cd("."),frequency:{interval:s,backoff:!0,max:3e5},standby:e.refreshStandby||"when-hidden"})}get connectionFailure(){return this._connectionFailure}get driveName(){return this._driveName}get restored(){return this._restored.promise}get fileChanged(){return this._fileChanged}get path(){return this._model?this._model.path:""}get rootPath(){return this._driveName?this._driveName+":":""}get pathChanged(){return this._pathChanged}get refreshed(){return this._refreshed}get specs(){return this.manager.services.kernelspecs.specs}get isDisposed(){return this._isDisposed}get uploadChanged(){return this._uploadChanged}uploads(){return this._uploads[Symbol.iterator]()}dispose(){this.isDisposed||(window.removeEventListener("beforeunload",this._unloadEventListener),this._isDisposed=!0,this._poll.dispose(),this._sessions.length=0,this._items.length=0,D.Signal.clearData(this))}items(){return this._items[Symbol.iterator]()}sessions(){return this._sessions[Symbol.iterator]()}async refresh(){await this._poll.refresh(),await this._poll.tick,this._refreshed.emit(void 0)}async cd(e="."){if(e="."!==e?this.manager.services.contents.resolvePath(this._model.path,e):this._pendingPath||this._model.path,this._pending){if(e===this._pendingPath)return this._pending;await this._pending}const t=this.path;this._pendingPath=e,t!==e&&(this._sessions.length=0);const s=this.manager.services;return this._pending=s.contents.get(e,{content:!0}).then((i=>{this.isDisposed||(this.handleContents(i),this._pendingPath=null,this._pending=null,t!==e&&(this._state&&this._key&&this._state.save(this._key,{path:e}),this._pathChanged.emit({name:"path",oldValue:t,newValue:e})),this.onRunningChanged(s.sessions,s.sessions.running()),this._refreshed.emit(void 0))})).catch((t=>{if(this._pendingPath=null,this._pending=null,t.response&&404===t.response.status&&"/"!==e)return t.message=this._trans.__('Directory not found: "%1"',this._model.path),console.error(t),this._connectionFailure.emit(t),this.cd("/");this._connectionFailure.emit(t)})),this._pending}async download(e){const t=await this.manager.services.contents.getDownloadUrl(e),s=document.createElement("a");s.href=t,s.download="",document.body.appendChild(s),s.click(),document.body.removeChild(s)}async restore(e,t=!0){const{manager:s}=this,i=`file-browser-${e}:cwd`,r=this._state;if(!this._key)if(this._key=i,t&&r){await s.services.ready;try{const e=await r.fetch(i);if(!e)return void this._restored.resolve(void 0);const t=e.path;t&&await this.cd("/");const n=s.services.contents.localPath(t);await s.services.contents.get(t),await this.cd(n)}catch(e){await r.remove(i)}this._restored.resolve(void 0)}else this._restored.resolve(void 0)}async upload(e){const t=l.PageConfig.getNotebookVersion(),s=t<[4,0,0]||t>=[5,1,0],i=e.size>$;if(i&&!s){const t=this._trans.__("Cannot upload file (>%1 MB). %2",$/1048576,e.name);throw console.warn(t),t}if(i&&!await this._shouldUploadLarge(e))throw"Cancelled large file upload";if(await this._uploadCheckDisposed(),await this.refresh(),await this._uploadCheckDisposed(),this._items.find((t=>t.name===e.name))&&!await(0,d.shouldOverwrite)(e.name))throw"File not uploaded";await this._uploadCheckDisposed();const r=s&&e.size>Z;return await this._upload(e,r)}async _shouldUploadLarge(e){const{button:t}=await(0,i.showDialog)({title:this._trans.__("Large file size warning"),body:this._trans.__("The file size is %1 MB. Do you still want to upload it?",Math.round(e.size/1048576)),buttons:[i.Dialog.cancelButton({label:this._trans.__("Cancel")}),i.Dialog.warnButton({label:this._trans.__("Upload")})]});return t.accept}async _upload(e,t){let s=this._model.path;s=s?s+"/"+e.name:e.name;const i=e.name,r=async(t,r)=>{await this._uploadCheckDisposed();const n=new FileReader;n.readAsDataURL(t),await new Promise(((t,s)=>{n.onload=t,n.onerror=t=>s(`Failed to upload "${e.name}":`+t)})),await this._uploadCheckDisposed();const a=n.result.split(",")[1],o={type:"file",format:"base64",name:i,chunk:r,content:a};return await this.manager.services.contents.save(s,o)};if(!t)try{return await r(e)}catch(t){throw h.ArrayExt.removeFirstWhere(this._uploads,(t=>e.name===t.path)),t}let n,a={path:s,progress:0};this._uploadChanged.emit({name:"start",newValue:a,oldValue:null});for(let t=0;!n;t+=Z){const i=t+Z,o=i>=e.size,l=o?-1:i/Z,d={path:s,progress:t/e.size};let c;this._uploads.splice(this._uploads.indexOf(a)),this._uploads.push(d),this._uploadChanged.emit({name:"update",newValue:d,oldValue:a}),a=d;try{c=await r(e.slice(t,i),l)}catch(t){throw h.ArrayExt.removeFirstWhere(this._uploads,(t=>e.name===t.path)),this._uploadChanged.emit({name:"failure",newValue:a,oldValue:null}),t}o&&(n=c)}return this._uploads.splice(this._uploads.indexOf(a)),this._uploadChanged.emit({name:"finish",newValue:null,oldValue:a}),n}_uploadCheckDisposed(){return this.isDisposed?Promise.reject("Filemanager disposed. File upload canceled"):Promise.resolve()}handleContents(e){this._model={name:e.name,path:e.path,type:e.type,content:void 0,writable:e.writable,created:e.created,last_modified:e.last_modified,size:e.size,mimetype:e.mimetype,format:e.format},this._items=e.content,this._paths.clear(),e.content.forEach((e=>{this._paths.add(e.path)}))}onRunningChanged(e,t){this._populateSessions(t),this._refreshed.emit(void 0)}onFileChanged(e,t){const s=this._model.path,{sessions:i}=this.manager.services,{oldValue:r,newValue:n}=t;if(r&&r.path&&l.PathExt.dirname(r.path)===s?r:n&&n.path&&l.PathExt.dirname(n.path)===s?n:void 0)return this._poll.refresh(),this._populateSessions(i.running()),void this._fileChanged.emit(t)}_populateSessions(e){this._sessions.length=0;for(const t of e)this._paths.has(t.path)&&this._sessions.push(t)}}class ee extends Q{constructor(e){super(e),this._includeHiddenFiles=e.includeHiddenFiles||!1}items(){return this._includeHiddenFiles?super.items():(0,h.filter)(super.items(),(e=>!e.name.startsWith(".")))}showHiddenFiles(e){this._includeHiddenFiles=e,this.refresh()}}class te extends ee{constructor(e){var t,s;super(e),this._filter=null!==(t=e.filter)&&void 0!==t?t:e=>({}),this._filterDirectories=null===(s=e.filterDirectories)||void 0===s||s}get filterDirectories(){return this._filterDirectories}set filterDirectories(e){this._filterDirectories=e}items(){return(0,h.filter)(super.items(),(e=>{if(this._filterDirectories||"directory"!==e.type){const t=this._filter(e);return e.indices=null==t?void 0:t.indices,!!t}return!0}))}setFilter(e){this._filter=e,this.refresh()}}var se,ie;!function(e){function t(e){const t=e.translator||n.nullTranslator,s=t.load("jupyterlab"),r={title:e.title,buttons:[i.Dialog.cancelButton(),i.Dialog.okButton({label:s.__("Select")})],focusNodeSelector:e.focusNodeSelector,host:e.host,renderer:e.renderer,body:new re(e.manager,e.filter,t)};return new i.Dialog(r).launch()}e.getOpenFiles=t,e.getExistingDirectory=function(e){return t({...e,filter:e=>"directory"===e.type?{}:null})}}(se||(se={}));class re extends o.Widget{constructor(e,t,s,r){super();const l=(s=null!=s?s:n.nullTranslator).load("jupyterlab");this.addClass("jp-Open-Dialog"),this._browser=ie.createFilteredFileBrowser("filtered-file-browser-dialog",e,t,{},s,r),(0,i.setToolbar)(this._browser,(e=>[{name:"new-folder",widget:new i.ToolbarButton({icon:a.newFolderIcon,onClick:()=>{e.createNewDirectory()},tooltip:l.__("New Folder")})},{name:"refresher",widget:new i.ToolbarButton({icon:a.refreshIcon,onClick:()=>{e.model.refresh().catch((e=>{console.error("Failed to refresh file browser in open dialog.",e)}))},tooltip:l.__("Refresh File List")})}]));const d=new o.PanelLayout;d.addWidget(this._browser),this.layout=d}getValue(){const e=Array.from(this._browser.selectedItems());return 0===e.length?[{path:this._browser.model.path,name:l.PathExt.basename(this._browser.model.path),type:"directory",content:void 0,writable:!1,created:"unknown",last_modified:"unknown",mimetype:"text/plain",format:"text"}]:e}}!function(e){e.createFilteredFileBrowser=(e,t,s,i={},r,a)=>{r=r||n.nullTranslator;const o=new te({manager:t,filter:s,translator:r,driveName:i.driveName,refreshInterval:i.refreshInterval,filterDirectories:a});return new G({id:e,model:o,translator:r})}}(ie||(ie={}));const ne=new b.Token("@jupyterlab/filebrowser:IFileBrowserFactory"),ae=new b.Token("@jupyterlab/filebrowser:IDefaultFileBrowser"),oe=new b.Token("@jupyterlab/filebrowser:IFileBrowserCommands");class le extends a.ToolbarButton{constructor(e){super({icon:a.fileUploadIcon,label:e.label,onClick:()=>{this._input.click()},tooltip:de.translateToolTip(e.translator)}),this._onInputChanged=()=>{const e=Array.prototype.slice.call(this._input.files).map((e=>this.fileBrowserModel.upload(e)));Promise.all(e).catch((e=>{(0,i.showErrorMessage)(this._trans._p("showErrorMessage","Upload Error"),e)}))},this._onInputClicked=()=>{this._input.value=""},this._input=de.createUploadInput(),this.fileBrowserModel=e.model,this.translator=e.translator||n.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._input.onclick=this._onInputClicked,this._input.onchange=this._onInputChanged,this.addClass("jp-id-upload")}}var de;!function(e){e.createUploadInput=function(){const e=document.createElement("input");return e.type="file",e.multiple=!0,e},e.translateToolTip=function(e){return(e=e||n.nullTranslator).load("jupyterlab").__("Upload Files")}}(de||(de={}));var he=s(1103),ce=s(78156),me=s.n(ce);function pe(e){const t=(e.translator||n.nullTranslator).load("jupyterlab");return me().createElement(he.GroupItem,{spacing:4},me().createElement(he.TextItem,{source:t.__("Uploading…")}),me().createElement(he.ProgressBar,{percentage:e.upload}))}class ue extends a.VDomRenderer{constructor(e){super(new ue.Model(e.tracker.currentWidget&&e.tracker.currentWidget.model)),this._onBrowserChange=(e,t)=>{this.model.browserModel=null===t?null:t.model},this.translator=e.translator||n.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._tracker=e.tracker,this._tracker.currentChanged.connect(this._onBrowserChange)}render(){return this.model.items.length>0?this.model.items[0].complete?me().createElement(he.TextItem,{source:this._trans.__("Complete!")}):me().createElement(pe,{upload:this.model.items[0].progress,translator:this.translator}):me().createElement(pe,{upload:100,translator:this.translator})}dispose(){super.dispose(),this._tracker.currentChanged.disconnect(this._onBrowserChange)}}!function(e){class t extends a.VDomModel{constructor(e){super(),this._uploadChanged=(e,t)=>{if("start"===t.name)this._items.push({path:t.newValue.path,progress:100*t.newValue.progress,complete:!1});else if("update"===t.name){const e=h.ArrayExt.findFirstIndex(this._items,(e=>e.path===t.oldValue.path));-1!==e&&(this._items[e].progress=100*t.newValue.progress)}else if("finish"===t.name){const e=h.ArrayExt.findFirstValue(this._items,(e=>e.path===t.oldValue.path));e&&(e.complete=!0,setTimeout((()=>{h.ArrayExt.removeFirstOf(this._items,e),this.stateChanged.emit(void 0)}),2e3))}else"failure"===t.name&&h.ArrayExt.removeFirstWhere(this._items,(e=>e.path===t.newValue.path));this.stateChanged.emit(void 0)},this._items=[],this._browserModel=null,this.browserModel=e}get items(){return this._items}get browserModel(){return this._browserModel}set browserModel(e){const t=this._browserModel;t&&t.uploadChanged.disconnect(this._uploadChanged),this._browserModel=e,this._items=[],null!==this._browserModel&&this._browserModel.uploadChanged.connect(this._uploadChanged),this.stateChanged.emit(void 0)}}e.Model=t}(ue||(ue={}))}}]);