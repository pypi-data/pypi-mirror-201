import{u as R}from"./group-store.43a1d7ec.js";import{ay as j,a5 as i,o as h,Q as C,R as o,c as x,a8 as Q,F as W,O as A,am as P,ak as N,S as q,X as t,a as p,Z as D,V as B,L as X,W as _,az as Z,aa as J}from"./vendor-vue.e07d7f7e.js";import{_ as y,d as G,r as Y}from"./index.c9528988.js";import{C as H}from"./ConnectStatus.39609056.js";import{d as F,a as ee}from"./element-plus.0d508af4.js";import{F as te}from"./vendor-lib.f93a8f58.js";import"./element-icon.bb5f2c38.js";const ae={domain:[{message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},se={name:"SelectGroup",props:{},components:{},data(){return{}},computed:{...j(R,{groupOptions:"getGroupOptions"})},methods:{async getData(){}},created(){this.getData()}};function ne(a,s,n,f,r,l){const m=i("el-option"),d=i("el-select");return h(),C(d,A(a.$attrs,P(a.$events),{placeholder:"\u5206\u7EC4"}),{default:o(()=>[(h(!0),x(W,null,Q(a.groupOptions,c=>(h(),C(m,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},16)}const L=y(se,[["render",ne]]),oe={name:"",props:{row:{type:Object,default:null}},components:{SelectGroup:L},data(){return{loading:!1,rules:ae,form:{domain:"",alias:"",group_id:""}}},computed:{},methods:{async getData(){if(this.loading=!0,this.row){let a={id:this.row.id},n=(await this.$http.getDomainById(a)).data;this.form.domain=n.domain,this.form.alias=n.alias,this.form.group_id=n.group_id,this.form.group_id==0&&(this.form.group_id="")}this.loading=!1},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(a=>{if(a)this.confirmSubmit();else return!1})},async confirmSubmit(){let a=this.$loading({fullscreen:!0}),s={domain:this.form.domain.trim(),alias:this.form.alias.trim(),group_id:this.form.group_id},n=null;this.row?(s.id=this.row.id,n=await this.$http.updateDomainById(s)):n=await this.$http.addDomain(s),n.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(n.msg),this.$nextTick(()=>{a.close()})}},created(){this.getData()}},le={class:"text-center"};function ie(a,s,n,f,r,l){const m=i("el-input"),d=i("el-form-item"),c=i("SelectGroup"),w=i("el-form"),S=i("el-button"),k=N("loading");return q((h(),x("div",null,[t(w,{ref:"form",model:r.form,rules:r.rules,"label-width":"80px"},{default:o(()=>[t(d,{label:"\u57DF\u540D",prop:"domain"},{default:o(()=>[t(m,{type:"text",modelValue:r.form.domain,"onUpdate:modelValue":s[0]||(s[0]=g=>r.form.domain=g),placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u5206\u7EC4",prop:"group_id"},{default:o(()=>[t(c,{class:"w-[150px]",modelValue:r.form.group_id,"onUpdate:modelValue":s[1]||(s[1]=g=>r.form.group_id=g),clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"\u5907\u6CE8",prop:"alias"},{default:o(()=>[t(m,{type:"textarea",modelValue:r.form.alias,"onUpdate:modelValue":s[2]||(s[2]=g=>r.form.alias=g),rows:3,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),p("div",le,[t(S,{onClick:l.handleCancel},{default:o(()=>[D("\u53D6 \u6D88")]),_:1},8,["onClick"]),t(S,{type:"primary",onClick:l.handleSubmit},{default:o(()=>[D("\u786E \u5B9A")]),_:1},8,["onClick"])])])),[[k,r.loading]])}const re=y(oe,[["render",ie]]),de={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:re},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(a){this.$emit("update:visible",a)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function ce(a,s,n,f,r,l){const m=i("DataForm"),d=i("el-dialog");return h(),C(d,{title:l.dialogTitle,modelValue:l.dialogVisible,"onUpdate:modelValue":s[0]||(s[0]=c=>l.dialogVisible=c),width:"400px",center:"","append-to-body":"","lock-scroll":!1},{default:o(()=>[l.dialogVisible?(h(),C(m,{key:0,row:n.row,onOnCancel:l.handleClose,onOnSuccess:l.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):B("",!0)]),_:1},8,["title","modelValue"])}const K=y(de,[["render",ce]]);const ue={name:"ExpiredDays",props:{value:{type:Number,default:null}},components:{},data(){return{}},computed:{showValue(){return Number.isInteger(this.value)},className(){return this.showValue?this.value<3?["color--danger"]:this.value<30?["color--warning"]:["color--success"]:[]}},methods:{async getData(){}},created(){this.getData()}},me={class:"ExpireDays"},pe={key:1};function _e(a,s,n,f,r,l){return h(),x("div",me,[l.showValue?(h(),x("span",{key:0,class:X(l.className)},_(n.value),3)):(h(),x("span",pe,"-"))])}const M=y(ue,[["render",_e]]),he={name:"",props:{row:{type:Object,default:null}},components:{ConnectStatus:H,ExpireDays:M},data(){return{form:{domain:"",domain_url:"",ip:"",start_time:"",expire_time:"",check_time:"",connect_status:"",total_days:"",expire_days:"",create_time:"",update_time:"",detail:{issuer:{},subject:{}},real_time_expire_days:"",domain_start_time:"",domain_expire_time:"",real_time_domain_expire_days:"",alias:""},ipInfo:{isp:""}}},computed:{},methods:{async getData(){if(this.row){let a={id:this.row.id};const s=await this.$http.getDomainById(a);if(s.code!=0)return;let n=s.data;this.form.domain=n.domain,this.form.domain_url=n.domain_url,this.form.ip=n.ip,this.form.start_time=n.start_time,this.form.expire_time=n.expire_time,this.form.check_time=n.check_time,this.form.connect_status=n.connect_status,this.form.total_days=n.total_days,this.form.expire_days=n.expire_days,this.form.real_time_expire_days=n.real_time_expire_days,this.form.create_time=n.create_time,this.form.update_time=n.update_time,this.form.alias=n.alias,this.form.domain_start_time=n.domain_start_time,this.form.domain_expire_time=n.domain_expire_time,this.form.real_time_domain_expire_days=n.real_time_domain_expire_days,this.form.detail={issuer:n.detail.issuer||{},subject:n.detail.subject||{}}}},handleCancel(){this.$emit("on-cancel")},async handleUpdateRowDomainInfo(){let a=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),s={id:this.row.id};(await this.$http.updateDomainCertInfoById(s)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.getData()),a.close()},async getIpInfo(){let a={ip:this.form.ip};const s=await this.$http.getIpInfo(a);s.code==0&&(this.ipInfo=s.data)}},created(){this.getData()}},fe={class:"domain-detail"},ge={class:"mo-form-detail grid grid-cols-2 mt-sm"},be={class:"flex justify-between flex-1"},ye=p("span",null," \u66F4\u65B0",-1),De={class:"mo-form-detail",style:{"margin-top":"20px"}},we={class:"truncate"},xe={class:"text-center mt-md"};function Ce(a,s,n,f,r,l){const m=i("el-link"),d=i("el-form-item"),c=i("ExpireDays"),w=i("el-form"),S=i("ConnectStatus"),k=i("Refresh"),g=i("el-icon"),v=i("el-button");return h(),x("div",fe,[p("div",ge,[t(w,{ref:"form",model:r.form,"label-width":"130px"},{default:o(()=>[t(d,{label:"\u57DF\u540D",prop:"domain"},{default:o(()=>[t(m,{underline:!1,href:r.form.domain_url,target:"_blank"},{default:o(()=>[D(_(r.form.domain),1)]),_:1},8,["href"])]),_:1}),t(d,{label:"ip",prop:"ip"},{default:o(()=>[p("span",null,_(r.form.ip||"-"),1)]),_:1}),t(d,{label:"\u57DF\u540D\u6CE8\u518C\u65F6\u95F4",prop:"create_time"},{default:o(()=>[p("span",null,_(r.form.domain_start_time||"-"),1)]),_:1}),t(d,{label:"\u57DF\u540D\u5230\u671F\u65F6\u95F4",prop:"create_time"},{default:o(()=>[p("span",null,_(r.form.domain_expire_time||"-"),1)]),_:1}),t(d,{label:"\u57DF\u540D\u5269\u4F59\u5929\u6570",prop:"create_time"},{default:o(()=>[t(c,{value:r.form.real_time_domain_expire_days},null,8,["value"])]),_:1}),t(d,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"create_time"},{default:o(()=>[p("span",null,_(r.form.create_time||"-"),1)]),_:1})]),_:1},8,["model"]),t(w,{ref:"form",model:r.form,"label-width":"130px"},{default:o(()=>[t(d,{label:"\u57DF\u540D\u8FDE\u63A5\u72B6\u6001",prop:"connect_status"},{default:o(()=>[t(S,{value:r.form.connect_status},null,8,["value"])]),_:1}),t(d,{label:"\u68C0\u67E5\u65F6\u95F4",prop:"check_time"},{default:o(()=>[p("div",be,[p("span",null,_(r.form.check_time||"-"),1),t(m,{underline:!1,type:"primary",onClick:l.handleUpdateRowDomainInfo},{default:o(()=>[t(g,null,{default:o(()=>[t(k)]),_:1}),ye]),_:1},8,["onClick"])])]),_:1}),t(d,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",prop:"start_time"},{default:o(()=>[p("span",null,_(r.form.start_time||"-"),1)]),_:1}),t(d,{label:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4",prop:"expire_time"},{default:o(()=>[p("span",null,_(r.form.expire_time||"-"),1)]),_:1}),t(d,{label:"\u8FC7\u671F\u5269\u4F59\u5929\u6570",prop:"real_time_expire_days"},{default:o(()=>[t(c,{value:r.form.real_time_expire_days},null,8,["value"])]),_:1}),t(d,{label:"\u66F4\u65B0\u65F6\u95F4",prop:"create_time"},{default:o(()=>[p("span",null,_(r.form.update_time||"-"),1)]),_:1})]),_:1},8,["model"])]),p("div",De,[t(w,{"label-width":"130px"},{default:o(()=>[t(d,{label:"\u5907\u6CE8",prop:"isp"},{default:o(()=>[p("span",we,_(r.form.alias||"-"),1)]),_:1})]),_:1})]),p("div",xe,[t(v,{type:"primary",onClick:l.handleCancel},{default:o(()=>[D("\u5173 \u95ED")]),_:1},8,["onClick"])])])}const Se=y(he,[["render",Ce]]),ve={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:Se},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(a){this.$emit("update:visible",a)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose()},handleDialogClose(){this.$emit("on-success")}},created(){}};function ke(a,s,n,f,r,l){const m=i("DataForm"),d=i("el-dialog");return h(),C(d,{title:"\u57DF\u540D\u8BE6\u60C5",modelValue:l.dialogVisible,"onUpdate:modelValue":s[0]||(s[0]=c=>l.dialogVisible=c),width:"800px",center:"","append-to-body":"","lock-scroll":!1,onClose:l.handleDialogClose},{default:o(()=>[l.dialogVisible?(h(),C(m,{key:0,row:n.row,onOnCancel:l.handleClose,onOnSuccess:l.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):B("",!0)]),_:1},8,["modelValue","onClose"])}const Ve=y(ve,[["render",ke]]),Oe={name:"ExpireProgress",props:{startTime:{type:String},endTime:{type:String}},components:{},data(){return{nowTime:F()}},computed:{parsedStartTime(){return F(this.startTime)},parsedEndTime(){return F(this.endTime)},totalDays(){return this.parsedEndTime.diff(this.parsedStartTime,"day")},expireDays(){return this.parsedEndTime.diff(this.nowTime,"day")},percentage(){let a=null;return this.expireDays&&this.totalDays&&(a=this.expireDays/this.totalDays*100),a},percentageStatus(){let a;return this.expireDays>=30?a="":this.expireDays>=3?a="warning":a="exception",a}},methods:{async getData(){}},created(){this.getData()}},Te={class:""},Ue={class:"el-text-color-primary"},Ie=p("span",null," / ",-1),$e={class:"el-text-color-secondary"};function ze(a,s,n,f,r,l){const m=i("el-progress");return h(),x("div",Te,[l.percentage?(h(),C(m,{key:0,percentage:l.percentage,"show-text":!1,status:l.percentageStatus},null,8,["percentage","status"])):B("",!0),p("div",null,[p("span",Ue,_(l.expireDays||"-"),1),Ie,p("span",$e,_(l.totalDays||"-"),1)])])}const Ee=y(Oe,[["render",ze]]),Fe={name:"",components:{DataFormDialog:K,DataDetailDialog:Ve,ConnectStatus:H,ExpireDays:M,ExpireProgress:Ee},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1,dialogDetailVisible:!1}},methods:{handleEditRow(a){this.currentRow=a,this.dialogVisible=!0},async handleDeleteClick(a){let s={id:a.id};const n=await this.$http.deleteDomainById(s);n.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(n.msg)},async handleStatusChange(a){let s={id:a.id};const n=await this.$Http.function(s);n.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(n.msg)},async handleMonitorStatusChange(a,s){let n={id:a.id,is_monitor:s};const f=await this.$http.updateDomainById(n);f.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(f.msg)},async handleUpdateRowDomainInfo(a){let s=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),n={id:a.id};(await this.$http.updateDomainCertInfoById(n)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")),s.close()},handleUpdateSuccess(){this.$emit("on-success")},handleDetailSuccess(){},handleShowDetail(a){this.currentRow=a,this.dialogDetailVisible=!0}},created(){}};function Re(a,s,n,f,r,l){const m=i("el-link"),d=i("el-tooltip"),c=i("el-table-column"),w=i("ExpireDays"),S=i("ExpireProgress"),k=i("ConnectStatus"),g=i("Tickets"),v=i("el-icon"),O=i("el-switch"),T=i("Refresh"),U=i("Edit"),I=i("Delete"),$=i("el-popconfirm"),z=i("el-table"),E=i("DataFormDialog"),b=i("DataDetailDialog");return h(),x("div",null,[t(z,A({data:n.list,stripe:"",border:""},a.$attrs,P(a.$events)),{default:o(()=>[t(c,{label:"\u57DF\u540D","header-align":"center",align:"center",width:"180","show-overflow-tooltip":"",prop:"domain"},{default:o(u=>[t(d,{disabled:!u.row.alias,content:u.row.alias},{default:o(()=>[t(m,{underline:!1,href:u.row.domain_url,target:"_blank"},{default:o(()=>[D(_(u.row.domain),1)]),_:2},1032,["href"])]),_:2},1032,["disabled","content"])]),_:1}),t(c,{label:"\u57DF\u540D\u5929\u6570","header-align":"center",align:"center",width:"110",sortable:"custom",prop:"domain_expire_days"},{default:o(u=>[t(w,{value:u.row.real_time_domain_expire_days},null,8,["value"])]),_:1}),t(c,{label:"\u8BC1\u4E66\u5929\u6570","header-align":"center",align:"center",width:"120",sortable:"custom",prop:"expire_days"},{default:o(u=>[t(S,{startTime:u.row.start_time,endTime:u.row.expire_time},null,8,["startTime","endTime"])]),_:1}),t(c,{label:"\u72B6\u6001","header-align":"center",align:"center",width:"60",prop:"connect_status"},{default:o(u=>[t(k,{value:u.row.connect_status},null,8,["value"])]),_:1}),t(c,{label:"\u5206\u7EC4","header-align":"center",align:"center",width:"100",prop:"check_time"},{default:o(u=>[p("span",null,_(u.row.group_name||"-"),1)]),_:1}),t(c,{label:"\u5907\u6CE8","header-align":"center",align:"center",prop:"check_time","show-overflow-tooltip":""},{default:o(u=>[p("span",null,_(u.row.alias||"-"),1)]),_:1}),t(c,{label:"\u66F4\u65B0\u65F6\u95F4","header-align":"center",align:"center",width:"100",prop:"check_time","show-overflow-tooltip":""},{default:o(u=>[p("span",null,_(u.row.check_time_label||"-"),1)]),_:1}),t(c,{label:"\u8BE6\u7EC6","header-align":"center",align:"center",width:"60",prop:"connect_status"},{default:o(u=>[t(m,{underline:!1,type:"primary",onClick:V=>l.handleShowDetail(u.row)},{default:o(()=>[t(v,null,{default:o(()=>[t(g)]),_:1})]),_:2},1032,["onClick"])]),_:1}),t(c,{label:"\u76D1\u6D4B",width:"66","header-align":"center",align:"center"},{default:o(u=>[t(O,{style:{transform:"scale(0.8)"},modelValue:u.row.is_monitor,"onUpdate:modelValue":V=>u.row.is_monitor=V,size:"mini",onChange:V=>l.handleMonitorStatusChange(u.row,V)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(c,{label:"\u64CD\u4F5C",width:"100","header-align":"center",align:"center"},{default:o(u=>[t(m,{underline:!1,type:"primary",class:"mr-sm",onClick:V=>l.handleUpdateRowDomainInfo(u.row)},{default:o(()=>[t(v,null,{default:o(()=>[t(T)]),_:1})]),_:2},1032,["onClick"]),t(m,{underline:!1,type:"primary",class:"mr-sm",onClick:V=>l.handleEditRow(u.row)},{default:o(()=>[t(v,null,{default:o(()=>[t(U)]),_:1})]),_:2},1032,["onClick"]),t($,{title:"\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:V=>l.handleDeleteClick(u.row)},{reference:o(()=>[t(m,{underline:!1,type:"danger"},{default:o(()=>[t(v,null,{default:o(()=>[t(I)]),_:1})]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},16,["data"]),t(E,{visible:r.dialogVisible,"onUpdate:visible":s[0]||(s[0]=u=>r.dialogVisible=u),row:r.currentRow,onOnSuccess:l.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"]),t(b,{row:r.currentRow,visible:r.dialogDetailVisible,"onUpdate:visible":s[1]||(s[1]=u=>r.dialogDetailVisible=u),onOnSuccess:l.handleDetailSuccess},null,8,["row","visible","onOnSuccess"])])}const Be=y(Fe,[["render",Re]]),Ge={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u66F4\u65B0":"\u5168\u90E8\u66F4\u65B0"}},methods:{async updateAllDomainCertInfoOfUser(){this.updateTimer=setInterval(()=>{this.getUpdateDomainStatusOfUser()},2e3),(await this.$http.updateAllDomainCertInfoOfUser()).code==0&&this.$msg.success("\u64CD\u4F5C\u6210\u529F")},async getUpdateDomainStatusOfUser(){const a=await this.$http.getUpdateDomainStatusOfUser();a.ok&&a.data.status==!1&&(clearInterval(this.updateTimer),this.updateTimer=null,this.$emit("on-success"))}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function je(a,s,n,f,r,l){const m=i("Refresh"),d=i("el-icon"),c=i("el-button");return h(),C(c,{onClick:l.updateAllDomainCertInfoOfUser,disabled:l.disableUpdateButton},{default:o(()=>[t(d,null,{default:o(()=>[t(m)]),_:1}),D(_(l.updateText),1)]),_:1},8,["onClick","disabled"])}const Ae=y(Ge,[["render",je]]),Pe={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u68C0\u67E5":"\u8BC1\u4E66\u68C0\u67E5"}},methods:{async checkDomainCert(){this.updateTimer=setInterval(()=>{this.getUpdateDomainStatusOfUser()},2e3),(await this.$http.checkDomainCert()).ok&&this.$msg.success("\u64CD\u4F5C\u6210\u529F")},async getUpdateDomainStatusOfUser(){const a=await this.$http.getCheckDomainStatusOfUser();a.ok&&a.data.status==!1&&(clearInterval(this.updateTimer),this.updateTimer=null,this.$emit("on-success"))}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function Ne(a,s,n,f,r,l){const m=i("Position"),d=i("el-icon"),c=i("el-button");return h(),C(c,{class:"margin-left--auto",onClick:l.checkDomainCert,disabled:l.disableUpdateButton},{default:o(()=>[t(d,null,{default:o(()=>[t(m)]),_:1}),D(_(l.updateText),1)]),_:1},8,["onClick","disabled"])}const qe=y(Pe,[["render",Ne]]),He={name:"domain-list",props:{},components:{DataFormDialog:K,DataTable:Be,SelectGroup:L,updateDomainInfo:Ae,CheckDomainInfo:qe},data(){return{dataApi:G,list:[],total:0,page:1,size:20,keyword:"",group_id:"",pageSizeCachekey:"pageSize",loading:!0,dialogVisible:!1,export_to_file_url:Y(G.exportDomainToFile),order_type:"ascending",order_prop:"expire_days"}},computed:{...j(R,{groupOptions:"getGroupOptions"})},methods:{...Z(R,{updateGroupOptions:"updateGroupOptions"}),resetData(){this.page=1,this.getData()},refreshData(){this.getData()},async getData(){this.loading=!0;let a={page:this.page,size:this.size,group_id:this.group_id,keyword:this.keyword.trim(),order_type:this.order_type,order_prop:this.order_prop};const s=await this.$http.getDomainList(a);s.code==0?(this.list=s.data.list.map(n=>(n.group_id&&(n.group_name=this.getGroupName(n.group_id)),n)),this.total=s.data.total):this.$msg.error(e.msg),this.loading=!1},getGroupName(a){let s=this.groupOptions.find(n=>n.value==a);if(s)return s.name},async handleHttpRequest(a){let s=this.$loading({fullscreen:!0}),n=new FormData;n.append("file",a.file),(await this.$http.importDomainFromFile(n)).code==0&&(this.$msg.success("\u4E0A\u4F20\u6210\u529F\uFF0C\u540E\u53F0\u5BFC\u5165\u4E2D"),this.resetData()),s.close()},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},async handleExportToFile(){let s=(await this.$http.getAllDomainListOfUser()).data.list.map(f=>f.domain).join(`
`);var n=new Blob([s],{type:"text/plain;charset=utf-8"});te.saveAs(n,"domain.txt")},handleSearch(){this.resetData()},handleSizeChange(a){localStorage.setItem(this.pageSizeCachekey,a),this.resetData()},loadPageSize(){let a=localStorage.getItem(this.pageSizeCachekey);a&&(this.size=parseInt(a))},handleExceed(a){this.$refs.upload.clearFiles();const s=a[0];s.uid=ee(),this.handleHttpRequest({file:s})},handleSortChange({column:a,prop:s,order:n}){console.log(a,s,n),this.order_type=n,this.order_prop=s,this.resetData()},async initData(){this.loadPageSize(),await this.updateGroupOptions(),this.getData()}},created(){this.initData()}},Le={class:"app-container"},Ke={class:"flex justify-between"},Me={class:"flex"};function Qe(a,s,n,f,r,l){const m=i("Plus"),d=i("el-icon"),c=i("el-button"),w=i("SelectGroup"),S=i("Search"),k=i("el-input"),g=i("updateDomainInfo"),v=i("CheckDomainInfo"),O=i("Upload"),T=i("el-upload"),U=i("Download"),I=i("DataTable"),$=i("el-pagination"),z=i("DataFormDialog"),E=N("loading");return h(),x("div",Le,[p("div",Ke,[p("div",null,[t(c,{type:"primary",onClick:l.handleAddRow},{default:o(()=>[t(d,null,{default:o(()=>[t(m)]),_:1}),D("\u6DFB\u52A0")]),_:1},8,["onClick"]),t(w,{class:"w-[150px] ml-sm",modelValue:r.group_id,"onUpdate:modelValue":s[0]||(s[0]=b=>r.group_id=b),clearable:"",onChange:l.resetData},null,8,["modelValue","onChange"]),t(k,{class:"ml-sm",style:{width:"260px"},modelValue:r.keyword,"onUpdate:modelValue":s[1]||(s[1]=b=>r.keyword=b),placeholder:"\u641C\u7D22\u57DF\u540D",clearable:"",onKeypress:J(l.handleSearch,["enter"]),onClear:l.handleSearch},{append:o(()=>[t(c,{onClick:l.handleSearch},{default:o(()=>[t(d,null,{default:o(()=>[t(S)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),p("div",Me,[t(g,{onOnSuccess:l.resetData},null,8,["onOnSuccess"]),t(v,{onOnSuccess:l.resetData},null,8,["onOnSuccess"]),t(T,{class:"ml-sm",ref:"upload",action:"action",accept:".txt",limit:1,"on-exceed":l.handleExceed,"show-file-list":!1,"http-request":l.handleHttpRequest},{default:o(()=>[t(c,null,{default:o(()=>[t(d,null,{default:o(()=>[t(O)]),_:1}),D("\u5BFC\u5165")]),_:1})]),_:1},8,["on-exceed","http-request"]),t(c,{class:"ml-sm",onClick:l.handleExportToFile},{default:o(()=>[t(d,null,{default:o(()=>[t(U)]),_:1}),D("\u5BFC\u51FA")]),_:1},8,["onClick"])])]),q(t(I,{class:"mt-md",list:r.list,onOnSuccess:l.resetData,onSortChange:l.handleSortChange},null,8,["list","onOnSuccess","onSortChange"]),[[E,r.loading]]),t($,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:r.total,"page-size":r.size,"onUpdate:page-size":s[2]||(s[2]=b=>r.size=b),"current-page":r.page,"onUpdate:current-page":s[3]||(s[3]=b=>r.page=b),onCurrentChange:l.getData,onSizeChange:l.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"]),t(z,{visible:r.dialogVisible,"onUpdate:visible":s[4]||(s[4]=b=>r.dialogVisible=b),onOnSuccess:l.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const at=y(He,[["render",Qe]]);export{at as default};
