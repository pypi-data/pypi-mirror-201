"use strict";(self.webpackChunk_jupyter_ai_core=self.webpackChunk_jupyter_ai_core||[]).push([[819],{5819:(e,t,n)=>{n.r(t),n.d(t,{CommandIDs:()=>F,NotebookTasks:()=>N,default:()=>P});var o=n(1123),l=n(1473),a=n(8142),r=n(8820);const i="api/ai";async function s(e="",t={}){const n=r.ServerConnection.makeSettings(),o=a.URLExt.join(n.baseUrl,i,e);let l;try{l=await r.ServerConnection.makeRequest(o,t,n)}catch(e){throw new r.ServerConnection.NetworkError(e)}let s=await l.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",l)}if(!l.ok)throw new r.ServerConnection.ResponseError(l,s.message||s);return s}var c;!function(e){e.sendPrompt=async function(e){let t;try{t=await s("prompt",{method:"POST",body:JSON.stringify(e)})}catch(e){return Promise.reject(e)}return t},e.listTasks=async function(){return s("tasks")},e.describeTask=async function(e){return s(`tasks/${e}`)}}(c||(c={}));var d=n(6271),u=n.n(d),p=n(4859),m=n(3191);function b(e){const[t,n]=(0,d.useState)(!1),[o,l]=(0,d.useState)(!1),{label:a,style:r,helperText:i,InputProps:s}=e,c=(0,d.useRef)(null);return(0,d.useEffect)((()=>{n(!1);const e=c.current;(null==e?void 0:e.offsetWidth)&&(null==e?void 0:e.scrollWidth)&&l(e.offsetWidth<e.scrollWidth)}),[e.text]),u().createElement("div",{id:e.id,style:{display:"flex",flexDirection:"column",...r}},u().createElement("span",{className:"jp-ai-ExpandableTextField-label"},a),u().createElement("div",{style:{display:"flex",flexDirection:"column"}},u().createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},null==s?void 0:s.startAdornment,u().createElement("span",{className:"jp-ai-ExpandableTextField-value "+(t?"jp-ai-ExpandableTextField-value-expanded":"jp-ai-ExpandableTextField-value-collapsed"),ref:c},e.text?e.text:!(null==s?void 0:s.startAdornment)&&"—")),o&&u().createElement("div",{style:{textDecoration:"underline"},onClick:()=>n(!t),className:"jp-ai-ExpandableTextField-value"},t?"Show Less":"Show More"),u().createElement("span",{className:"jp-ai-ExpandableTextField-label",style:{maxWidth:"fit-content"}},i)))}async function f(e,t){return e.commands.execute(`ai:insert-${t.response.insertion_mode}`,t),!0}var v=n(1893);function g(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function y(){const e=document.body.getAttribute("data-jp-theme-light");return(0,v.Z)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:g("--jp-layout-color1"),default:g("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:g("--jp-brand-color1"),light:g("--jp-brand-color2"),dark:g("--jp-brand-color0")},error:{main:g("--jp-error-color1"),light:g("--jp-error-color2"),dark:g("--jp-error-color0")},warning:{main:g("--jp-warn-color1"),light:g("--jp-warn-color2"),dark:g("--jp-warn-color0")},success:{main:g("--jp-success-color1"),light:g("--jp-success-color2"),dark:g("--jp-success-color0")},text:{primary:g("--jp-ui-font-color1"),secondary:g("--jp-ui-font-color2"),disabled:g("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:g("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}const h={above:"AI output will be inserted above the selected text",replace:"AI output will replace the selected text",below:"AI output will be inserted below the selected text","above-in-cells":"AI output will be inserted above in new notebook cells","below-in-cells":"AI output will be inserted below in new notebook cells"};function w(e){const[t,n]=(0,d.useState)([]),[o,l]=(0,d.useState)(""),[a,r]=(0,d.useState)(),[i,s]=(0,d.useState)(""),[v,g]=(0,d.useState)(!1);(0,d.useEffect)((()=>{!async function(){const e=await c.listTasks();if(n(e.tasks),!e.tasks.length)return void console.error("No tasks returned via the backend");const t=e.tasks[0].id;l(t);const o=await c.describeTask(t);r(o)}()}),[]),(0,d.useEffect)((()=>{var e;(null===(e=null==a?void 0:a.engines)||void 0===e?void 0:e.length)&&s(a.engines[0].id)}),[a]);const w=(null==a?void 0:a.insertion_mode)&&a.insertion_mode in h?h[a.insertion_mode]:"";return u().createElement(p.Z,{theme:y()},u().createElement(m.Box,{padding:1,width:"40em"},u().createElement(m.Stack,{spacing:4},u().createElement(m.FormControl,{fullWidth:!0},u().createElement(m.InputLabel,{id:"task-select-label"},"Task"),u().createElement(m.Select,{value:o,onChange:async e=>{l(e.target.value);const t=await c.describeTask(e.target.value);r(t)},label:"Task",labelId:"task-select-label",MenuProps:{style:{zIndex:2e4}},autoFocus:!0},t.map((e=>u().createElement(m.MenuItem,{key:e.id,value:e.id},e.name))))),u().createElement(m.Box,{pt:4,width:"40em"},u().createElement(m.Stack,{spacing:4},u().createElement(m.FormControl,{fullWidth:!0},u().createElement(m.InputLabel,{id:"engine-select-label"},"Model engine"),u().createElement(m.Select,{value:i,onChange:async e=>{s(e.target.value)},label:"Model engine",labelId:"engine-select-label",MenuProps:{style:{zIndex:2e4}},autoFocus:!0},null==a?void 0:a.engines.map((e=>u().createElement(m.MenuItem,{key:e.id,value:e.id},e.name))))),u().createElement(b,{label:"Prompt template",text:null==a?void 0:a.prompt_template}),w&&u().createElement(b,{label:"Task description",text:w}))),u().createElement(m.Stack,{direction:"row",justifyContent:"flex-end",spacing:1},u().createElement(m.Button,{variant:"outlined",onClick:e.closeDialog},"Cancel"),u().createElement(m.Button,{variant:"contained",onClick:async()=>{g(!0);try{const t={task_id:o,engine_id:i,prompt_variables:{body:e.selectedText}},n=await c.sendPrompt(t);return f(e.app,{widget:e.editorWidget,request:t,response:n}),e.closeDialog(),!0}catch(e){return alert("**Failed** with error:\n```\n"+e.message+"\n```"),g(!1),!1}},disabled:!!v||""===o},v?"Submitting…":"Submit")))))}var x=n(3033);class k extends x.Dialog{constructor(e){const t={...e.props,closeDialog:()=>{this.dispose()}};super({...e.body,body:x.ReactWidget.create(u().createElement(e.body,Object.assign({},t))),buttons:[]})}async open(){try{await super.launch()}catch(e){if(void 0!==e)throw e}}}function C(e){const t=E(e);if(!t)return"";const n=t.getSelection(),o=t.getOffsetAt(n.start),l=t.getOffsetAt(n.end);return t.model.sharedModel.getSource().substring(o,l)}function E(e){var t;let n;return e instanceof l.FileEditor?n=e.editor:e instanceof o.Notebook&&(n=null===(t=e.activeCell)||void 0===t?void 0:t.editor),n}function S(e,t){var n;const o=null===(n=e.model)||void 0===n?void 0:n.sharedModel.cells.findIndex((e=>e.getId()===t));return void 0===o?-1:o}function I(e,t){return async function(){var n;const l=null===(n=e.currentWidget)||void 0===n?void 0:n.content;if(!l)return console.error("Notebook is undefined."),!1;const a=l.activeCell;if(null===a)return console.error("Current cell is null."),!1;"raw"===a.model.type&&console.error("Current cell has invalid type `raw`.");const r="markdown"===a.model.type?N.GenerateCode:N.ExplainCode,i=a.model.sharedModel.getSource();console.log(`Calling ${r} command on source ${i}`);const s=function(e,t){const n=e.model,l=e.activeCellIndex;if(null===n)return"";"above-in-cells"===t?o.NotebookActions.insertAbove(e):o.NotebookActions.insertBelow(e);const a=e.activeCellIndex;o.NotebookActions.changeCellType(e,"markdown");const r=n.cells.get(a);return null==r||r.sharedModel.setSource("Analyzing your code …"),o.NotebookActions.runAndAdvance(e),e.activeCellIndex=l,r.id}(l,r===N.ExplainCode?"above-in-cells":"below-in-cells"),d={task_id:r,engine_id:"chatgpt",prompt_variables:{body:i}};let u;try{u=await c.sendPrompt(d)}catch(e){return function(e,t,n){var l,a;const r=S(e,t);-1!==r&&(e.activeCellIndex=r,o.NotebookActions.changeCellType(e,"markdown"),null===(a=null===(l=e.model)||void 0===l?void 0:l.cells.get(r))||void 0===a||a.sharedModel.setSource(n),o.NotebookActions.run(e))}(l,s,"**Failed** with error:\n```\n"+e.message+"\n```"),!1}finally{!function(e,t){var n;const o=S(e,t);-1!==o&&(null===(n=e.model)||void 0===n||n.sharedModel.deleteCell(o))}(l,s)}return f(t,{widget:l,request:d,response:u}),!0}}function A(e){return function(t){var n,o,l;const{widget:a,request:r,response:i}=t,s=E(a);if(!s)return!1;switch(e){case"above":null===(n=s.replaceSelection)||void 0===n||n.call(s,`${i.output}\n\n${r.prompt_variables.body}`);break;case"below":null===(o=s.replaceSelection)||void 0===o||o.call(s,`${r.prompt_variables.body}${i.output}`);break;case"replace":null===(l=s.replaceSelection)||void 0===l||l.call(s,i.output)}return!0}}function j(e){return function(t){var n;const{widget:l,response:a}=t;if(!(l instanceof o.Notebook))return console.error('Editor widget is not of type "Notebook".'),!1;const r=function(e){const t=[],n=e.split(/(```[a-z]*\n[\s\S]*?```)/g).map((e=>e.trim()));for(const e of n){let n="",o="markdown";e.startsWith("```")?(o="code",n=e.replace(/^```[a-z]*\n/,"").replace(/```$/,"").trim()):n=e.trim(),n.length>0&&t.push({cellType:o,source:n})}return t}(a.output);if(r.length<1)return console.error("No output cells."),!1;"above-in-cells"===e?o.NotebookActions.insertAbove(l):o.NotebookActions.insertBelow(l);for(let e=0;e<r.length;e++){const t=r[e];e>0&&o.NotebookActions.insertBelow(l),null===(n=l.activeCell)||void 0===n||n.model.sharedModel.setSource(t.source),o.NotebookActions.changeCellType(l,t.cellType),"markdown"===t.cellType&&o.NotebookActions.run(l)}return!0}}function T(e,t){return async function(){var n;const o=null===(n=e.currentWidget)||void 0===n?void 0:n.content;if(!o)return!1;const l=C(o);return new k({body:w,props:{selectedText:l,app:t,editorWidget:o}}).open(),!0}}const M=new(n(2502).LabIcon)({name:"jupyterlab-ai:psychology",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="css-10cscxr" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="PsychologyIcon">\n    <path d="M13 8.57c-.79 0-1.43.64-1.43 1.43s.64 1.43 1.43 1.43 1.43-.64 1.43-1.43-.64-1.43-1.43-1.43z"></path><path d="M13 3C9.25 3 6.2 5.94 6.02 9.64L4.1 12.2c-.25.33-.01.8.4.8H6v3c0 1.1.9 2 2 2h1v3h7v-4.68c2.36-1.12 4-3.53 4-6.32 0-3.87-3.13-7-7-7zm3 7c0 .13-.01.26-.02.39l.83.66c.08.06.1.16.05.25l-.8 1.39c-.05.09-.16.12-.24.09l-.99-.4c-.21.16-.43.29-.67.39L14 13.83c-.01.1-.1.17-.2.17h-1.6c-.1 0-.18-.07-.2-.17l-.15-1.06c-.25-.1-.47-.23-.68-.39l-.99.4c-.09.03-.2 0-.25-.09l-.8-1.39c-.05-.08-.03-.19.05-.25l.84-.66c-.01-.13-.02-.26-.02-.39s.02-.27.04-.39l-.85-.66c-.08-.06-.1-.16-.05-.26l.8-1.38c.05-.09.15-.12.24-.09l1 .4c.2-.15.43-.29.67-.39L12 6.17c.02-.1.1-.17.2-.17h1.6c.1 0 .18.07.2.17l.15 1.06c.24.1.46.23.67.39l1-.4c.09-.03.2 0 .24.09l.8 1.38c.05.09.03.2-.05.26l-.85.66c.03.12.04.25.04.39z">\n    </path>\n</svg>'});var N,F;!function(e){e.GenerateCode="generate-code-in-cells-below",e.ExplainCode="explain-code-in-cells-above"}(N||(N={})),function(e){e.explainCodeCell="ai:explain-code-cell",e.codifyMdCell="ai:codify-md-cell",e.explainOrCodifyCell="ai:explain-or-codify-cell",e.generateFromNotebookSelection="ai:generate-from-notebook-selection",e.generateFromEditorSelection="ai:generate-from-editor-selection",e.insertAbove="ai:insert-above",e.insertBelow="ai:insert-below",e.insertReplace="ai:insert-replace",e.insertAboveInCells="ai:insert-above-in-cells",e.insertBelowInCells="ai:insert-below-in-cells"}(F||(F={}));const P={id:"jupyter_ai:plugin",autoStart:!0,requires:[o.INotebookTracker,l.IEditorTracker],activate:(e,t,n)=>{const{commands:o}=e;o.addCommand(F.generateFromNotebookSelection,{execute:T(t,e),label:"Generate output from selection with AI...",icon:M,isEnabled:()=>{var e;const n=null===(e=null==t?void 0:t.currentWidget)||void 0===e?void 0:e.content;return!(!n||!C(n))}}),o.addCommand(F.generateFromEditorSelection,{execute:T(n,e),label:"Generate output from selection with AI...",icon:M,isEnabled:()=>{var e;const t=null===(e=null==n?void 0:n.currentWidget)||void 0===e?void 0:e.content;return!(!t||!C(t))}}),o.addCommand(F.insertAbove,{execute:A("above")}),o.addCommand(F.insertBelow,{execute:A("below")}),o.addCommand(F.insertReplace,{execute:A("replace")}),o.addCommand(F.insertAboveInCells,{execute:j("above-in-cells")}),o.addCommand(F.insertBelowInCells,{execute:j("below-in-cells")}),o.addCommand(F.explainCodeCell,{execute:I(t,e),label:"Explain cell with AI",icon:M}),o.addCommand(F.codifyMdCell,{execute:I(t,e),label:"Codify cell with AI",icon:M}),o.addCommand(F.explainOrCodifyCell,{execute:I(t,e),label:"Explain or codify cell with AI",icon:M})}}}}]);