[tox]
minversion = 3.4.0
envlist = py38,py39,cov
isolated_build = True
requires =
    toml

[testenv]
setenv =
    py{38,39}: COVERAGE_FILE=.coverage.{envname}
deps = -r requirements.txt
commands =
    pip list
    py{38,39}: pytest {posargs}
    cov: coverage combine --keep
    cov: coverage report --show-missing --fail-under=60

[testenv:build]
skip_install = True
deps =
    setuptools_scm
    wheel
commands =
    python setup.py sdist bdist_wheel

[testenv:build_reqs]
deps =
    pip-tools
    pip
skip_install = True
commands =
    pip-compile --extra docs,test

[testenv:docs]
changedir = docs
allowlist_externals = make
deps = .[docs]
commands =
    make html

[testenv:upload]
deps =
    twine
passenv =
    PYPI_USERNAME
    PYPI_PASSWORD
skip_install = True
commands =
    twine upload --skip-existing --non-interactive --username "{env:PYPI_USERNAME}" --password "{env:PYPI_PASSWORD}" dist/*
